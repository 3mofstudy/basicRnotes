[["index.html", "R語言程式設計 Chapter 1 關於 1.1 關於作者 1.2 寫書的起源 1.3 本書的理解 1.4 參考資料", " R語言程式設計 露西Lucy 2025-03-18 Chapter 1 關於 1.1 關於作者 跨領域的我，早年是在醫院及大學從事研究助理，協助教授或醫師收集臨床試驗的病人，在漫長工作生涯中，發現收集臨床資料，進行統計分析，是個人最喜歡的工作項目。早年學校習得高等統計知識及SPSS軟體應用後，到自己出社會以後自學R，在資料分析的路上越走越遠，但仍感謝過去工作實務經驗讓自己即使跨領域，轉行投入氣象數據分析，也不至於讓自己窘迫。 1.2 寫書的起源 網路上其實很多免費的線上R教學，基礎教學偏多，而稍複雜一點Code常常散落各地，雖然自身有用Nation隨時進行筆記摘錄，但是隨著筆記越來越多時，便有了想統整一份專屬自己學習後的內化筆記，而當這想法開始縈繞在我心中時，便有了開始撰寫這本線上電子書念頭。本書定位為起始筆記第一個敲門磚，未來會逐步加強充實內容，預計會寫下列幾個系列筆記，第一筆記R語言程式設計(基礎、中階及高階)，不太涉及統計原理方面知識，而是單純介紹R程式語言，屬於R的基本功，而實務上進行一項專案統計分析時，往往有70%時間都是進行資料前處理，各種資料轉換，遺失值處理、特徵轉化的步驟，這最需要就是R的基本功，熟練基本功可以讓自己工作效率大幅提升。第二筆記 統計學與R操作，側重在統計學觀念的釐清及如何應用R來進行統計分析，此部分教學，會與SPSS進行搭配輔助說明，其目的是讓有一定統計知識且慣用SPSS的統計人員，能利用過去分析經驗來銜接，輔助有心轉換分析跑道的學者能快速使用R來進行統計。第三部分 簡單介紹R資料視覺化與網路爬蟲， 第四部份介紹時下最流行大數據分析，例如非監督式學習、監督式學習，第 五部份重點在於精進R分析者工作技能，例如如何用R來 自動收信及寄信，用R串聯google文件、google活頁簿，進行線上互動。 R語言程式設計 (本書的重點) 基礎R語言 進階R語言 統計原理與軟體實作 統計與機率 描述性統計 推論性統計 存活分析 資料視覺化與網路爬蟲 網路爬蟲與R程式 各式資料下載與串接 資料視覺化 大數據分析與R 資料庫介紹(關聯式VS非關聯式) 非監督式學習 監督式學習 R及RStudio專章性學習 RStudio與git、GitHub 互動 串聯google文件、google活頁簿 用R程式來自動收信及寄信 用R及RStudio發表線上電子書 用R、RStudio及Hguo建立專屬個人部落格 1.3 本書的理解 猶記得剛開始自學R，是報名台大資訊訓練班假日面授課程，老師上課很快，常常基礎功稍微介紹一點後，老師就開始教導各種R好用套件，例如data.table、dplyr套件應用，但對一個小菜雞的我，即便學會這些進階套件，我仍對基礎R是一知半解，而實務上遵循老師教法使用這些套件時，常常出現一些不可預期錯誤，我完全不會解決bug，所以又只好買很多R的書籍，上了很多其他視訊課程，才慢慢把R基礎知識搞懂，現在的我才明白，不是老師教得不好，而是學海無涯，老師通常只能用最短時間講解最精華的部分，最後只能是師父引進門，修行在個人，靠大家自己不斷磨練精進自己的知識與技能。 我個人學習一個新知識新技術時，往往會先理解整個大架構，再慢慢精讀每一個章節，學習R語言也是如此，所以即使data.table、dplyr或者lubridate等套件真的很有用，但是基本功的 data.frame使用 也很重要。實務上常常做各種資料轉換，有些資料凌亂無法應用這些套件，基礎功的函數雖然執行效率比較慢，但卻能應付大部分工作，不容易因格式不符而出現錯誤連連的訊息。 初學者不應該先追求程式效率，而是著重於能實現心中所想要功能，所以即便初學者花100行代碼，寫了要花10秒才能執行完畢的功能，但至少是成功完成這項工作任務。往後等熟習這些程式邏輯，再練習寫更進階語法，來優化程式碼(舉例從原先100行10秒執行完畢才能完成功能，縮短到只需要50行3秒就能執行，就是優化)，下表示我整理出來程度表，本書分成初階、中階及高級，建議初學者應該先把基礎程式搞懂後，在慢慢學習中高階寫法，後面才能越來越駕輕就熟。下表以簡單例子來解釋，例如迴圈章節而言，新手用for迴圈，有點底子用apply，高手用purrr套件。 程度 資料結構 迴圈 日期轉換 資料合併 基礎 data.frame for迴圈 as.Date as.POSIXct cbind, rbind 進階 data.table apply家族函式 purrr家族函式 lubridate套件 dplyr套件(join函數) 最後提醒，學程式也忌諱未學會走路就急學跑步，基礎R知識未搞懂，就貿然去學習高級語法，往後日子常與Error message為伍，次數多到開始懷疑人生，懷疑自己選擇是否正確，是否要放棄R? 然而別放棄，慢慢循序漸進，基礎功打底，R的美好將逐漸向你靠近，努力加油 ，共勉之。 1.4 參考資料 曾意儒 –資料科學與R語言 郭耀仁 –認識R的美好 林建甫 –R資料科學與統計 "],["系統環境設定.html", "Chapter 2 系統環境設定 2.1 系統環境查詢 2.2 環境設定函數 2.3 更改環境語系 2.4 新增專案 2.5 常用快速鍵", " Chapter 2 系統環境設定 2.1 系統環境查詢 使用sessionInfo()可以查詢目前R運行的詳細情形，包含R版本號、R套件清單與版本號、語系 ##查詢目前系統環境 sessionInfo() ## R version 4.4.3 (2025-02-28 ucrt) ## Platform: x86_64-w64-mingw32/x64 ## Running under: Windows 11 x64 (build 26200) ## ## Matrix products: default ## ## ## locale: ## [1] LC_COLLATE=Chinese (Traditional)_Taiwan.utf8 ## [2] LC_CTYPE=Chinese (Traditional)_Taiwan.utf8 ## [3] LC_MONETARY=Chinese (Traditional)_Taiwan.utf8 ## [4] LC_NUMERIC=C ## [5] LC_TIME=Chinese (Traditional)_Taiwan.utf8 ## ## time zone: Asia/Taipei ## tzcode source: internal ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## loaded via a namespace (and not attached): ## [1] digest_0.6.37 R6_2.6.1 bookdown_0.45 fastmap_1.2.0 ## [5] xfun_0.53 cachem_1.1.0 knitr_1.50 htmltools_0.5.8.1 ## [9] rmarkdown_2.29 lifecycle_1.0.4 cli_3.6.5 sass_0.4.10 ## [13] jquerylib_0.1.4 compiler_4.4.3 rstudioapi_0.17.1 tools_4.4.3 ## [17] evaluate_1.0.5 bslib_0.9.0 yaml_2.3.10 jsonlite_2.0.0 ## [21] rlang_1.1.6 查詢或設定環境目錄 使用setwd，可以指定某個資料夾為當前環境目錄，getwd可以查詢目前的環境目錄。 ##設定當前目錄 setwd(&quot;C:/github/basicRnotes&quot;) ##查詢當前目錄 getwd() 如果懶得打指令，也可以透過RStudio視窗中的選項按鈕來執行，Set As Working Directory 等同於setwd指令， Go To Working Directory等同於getwd指令。 2.2 環境設定函數 環境設定函數為options()，用options()指令可以設定一些環境變量，使用help(options)可以查看詳細的參數資訊，常見操作如下: 數字位數的設置，options(digits=n)，n一般預設是7位，但實際上的範圍是1~22，可以隨意設定位數。 #這個指令，可以把R的整數表示能力設為10位元。 options(digits=10) 套件的安裝，使用下面的命令，可以指定預備下載端點。 options(CRAN=&quot;http://cran.r-project.org&quot;) install.packages(&quot;套件名稱&quot;) 設定游標類型(prompt參數設定)。 ##游標開始預設為 &gt; options(prompt=&quot;$&quot;) 設置 忽略警告(或錯誤)訊息出現 ##忽略任何警告，不顯示 options(warn=-1) ##顯示警告(預設) options(warn=1) 2.3 更改環境語系 用Sys.setlocale()查看當前語系(預設中文)，調整locale參數可暫時修改語系，但重開R時，語系會返回預設值。 Sys.setlocale() ## [1] &quot;LC_COLLATE=Chinese (Traditional)_Taiwan.utf8;LC_CTYPE=Chinese (Traditional)_Taiwan.utf8;LC_MONETARY=Chinese (Traditional)_Taiwan.utf8;LC_NUMERIC=C;LC_TIME=Chinese (Traditional)_Taiwan.utf8&quot; 將中文語系改為英文語系(暫時性) Sys.setlocale(&quot;LC_TIME&quot;, locale =&quot;English&quot;) # 也可以用 en.UTF-8 ## [1] &quot;English_United States.1252&quot; #範例 format(Sys.Date(), &quot;%A&quot;) #星期 ## [1] &quot;Sunday&quot; 將英文語系變回中文語系 Sys.setlocale(&quot;LC_TIME&quot;, locale =&quot;zh_TW.UTF-8&quot;) ## [1] &quot;zh_TW.UTF-8&quot; format(Sys.Date(), &quot;%A&quot;) #星期 ## [1] &quot;星期日&quot; 4.各國語系設定 國家語系 語系設定 format(Sys.Date(), “%A”) 範例輸出 日本 Sys.setlocale(“LC_TIME”, locale =“ja_JP.UTF-8”) “土曜日” 韓國 Sys.setlocale(“LC_TIME”, locale =“ko_KR.UTF-8”) “토요일” 德語 Sys.setlocale(“LC_TIME”, locale =“de_DE.UTF-8”) “Samstag” 俄語 Sys.setlocale(“LC_TIME”, locale =“ru_RU.UTF-8”) “суббота” 西班牙語 Sys.setlocale(“LC_TIME”,locale =“es_ES.UTF-8”) “sábado” 泰語 Sys.setlocale(“LC_TIME”, locale =“th_TH.UTF-8”) “เสาร์” 越南語 Sys.setlocale(“LC_TIME”, locale =“vi_VN.UTF-8”) “Thứ Bảy” 2.4 新增專案 RStudio是一個很強大IDE工具，凡是R使用者幾乎都是利用RStudio進行開發，RStudio可以輕鬆新增一個專案，為每一個專案設置專屬環境，安裝不同版本R及相關R套件，開啟新的專案可從工具列選取File -&gt; New Project。 點選New Projet按鈕後，會出現三個選項，選項功能如下 New Directory: 建立新資料夾來新增專案 Existing Directory:用舊有資料夾來新增專案 Version Control: 建立Git/subversion版本控管的新專案 其實如想要建立有Git版本控管的新專案，可直接選擇New Directory-&gt; New Project， 勾選Create a git repository ，命名好專案名稱及選定存放位置後， 按下Create Project，即可建好新專案 創建好新專案後，RStudio通常會自動開啟新專案，可由RStudio右上角看到目前處於哪個專案中，在檔案目錄中，可看到以專案名稱為名稱的.Rproj檔，該檔就是專屬的R專案設定檔，若是哪一天該資料夾不再當專案使用時，只要刪除.Rproj檔即可。 設定專案有很多好處，除為每一個專案設置專屬環境，安裝不同版本R及相關R套件，工作路徑資料夾也是預設，同時RStudio的專案資料夾可以結合Git，做到新增或修改成程式碼後，就能進行版本控管，並可以同步更新到GitHub。 除此之外，RStudio預設許多不同的專案範本，可以讓使用者輕鬆利用這些專案範本建立套件、電子書、部落格及互動式網頁，功能強大且齊全。 2.5 常用快速鍵 快速鍵 說明 快速鍵 說明 Ctrl + L 清除Console Ctrl + = 放大螢幕 Alt + - 賦值 &lt;- Ctrl + - 縮小螢幕 Ctrl +Shift+ C 註解/取消註解 Ctrl + Enter 執行當前程式碼 Ctrl +Shift+ M 串流 %&gt;% Ctrl +Alt +R 執行全部程式碼 Ctrl +Shift+ N 新增.R檔 Ctrl +Alt +A 執行先前程式碼 "],["元素介紹.html", "Chapter 3 元素介紹 3.1 資料賦值 3.2 資料型態 3.3 屬性查詢與轉換 3.4 運算子", " Chapter 3 元素介紹 3.1 資料賦值 資料的賦值，又稱為變數的設定。在進入R領域前，需要理解何謂是變數，變數就是可變動的數值，設定方式為變數名稱。在R中&lt;- 及=符號皆可被用來賦予變數，但R科學家更常使用&lt;-，在RStudio中，可用快速鍵Alt+- 快速形成 a &lt;- 10 b = 15 a+b ## [1] 25 3.2 資料型態 資料型態可分成一般性資料型態，和特殊性資料型態，初學者基本上學會一般性資料型態就已足夠，而特殊性資料型態通常應用在特殊環境，例如factor是R程式特殊專有資料型態，常運用統計學上類別變量相關分析，ts常用於與時間序列有關的統計。本章節會介紹一般性常見的資料型態，特殊性資料型態會在之後章節(中級篇或高級篇)，進一步介紹。 一般性(常見性) 特殊性 字串(character) 因素(factor) 數值(numeric) 時間序列(ts) 布林值(logic) 地圖格式(sp, sf) 日期/時間 (Date/ POSIXct POSIXt) 其他( eg..) 3.2.1 字串 字串可用單引號或雙引號包起來代表，何時使用單引號或雙引號其實是隨意，只是需要注意一點，當單引號亦視為字串中內容時，外圍則須用雙引號包起來，反之亦然 name &lt;- &quot;Mary Wang&quot; print(name) ## [1] &quot;Mary Wang&quot; citizenship &lt;- &#39;Japan&#39; print(citizenship) ## [1] &quot;Japan&quot; sentences &lt;- &quot;I&#39;m an adult&quot; #單引號需包在雙引號內 print(sentences) ## [1] &quot;I&#39;m an adult&quot; 3.2.2 數值 數學的數包含實數(numeric)和複數(complex)，R是專為計算數學相關領域而發展的程式語言，數的型態多於其他程式語言，R能處理實數(numeric)與複數(complex)， 實數又包括整數（沒有小數點）與浮點數（有小數點）的數值，所以在R的數值中，通常分成三種，分別為: numeric: 浮點數 integer: 整數 complex: 複數 一般可以用class來檢查變數類型，正常來說，數字都是預設為浮點數 class(5) ## [1] &quot;numeric&quot; 若要指定整數，可以在數字後面加上L class(5L) ## [1] &quot;integer&quot; 若要新增一個複數也很簡單，在數字後面加上i就行了 class(3i) ## [1] &quot;complex&quot; 3.2.3 布林值 布林值又稱為邏輯值((logic)，用於邏輯判斷，可使用大寫TRUE或T代表真，大寫FALSE或F代表假，此外布林值可以進行加減運算， TRUE =1 ，FALSE =0 A &lt;- TRUE class(A) ## [1] &quot;logical&quot; B &lt;- FALSE class(B) ## [1] &quot;logical&quot; C &lt;-T class(B) ## [1] &quot;logical&quot; print(A+B+C) ## [1] 2 3.2.4 日期/時間 (1) 取得當下時間資訊 R內建有幾個函數，可以查詢當下系統的日期、時間及時區資訊 Sys.Date() #當前日期 類似lubridate::today() ## [1] &quot;2025-11-16&quot; date() #當前系統日期和時間 ## [1] &quot;Sun Nov 16 22:23:29 2025&quot; Sys.time() #當前系統日期和時間 lubridate::now() ## [1] &quot;2025-11-16 22:23:29 CST&quot; Sys.timezone() #有關時區的信息將返回當前時區的名稱 ## [1] &quot;Asia/Taipei&quot; (2) as.Date 函數(文字轉日期) as.Date 可以將文字或數字格式轉換成日期格式，使用時，第一個參數若放文字格式，後面,tryFormats參數輸入相對應的原文字格式 as.Date(&quot;2024-01-05&quot;,tryFormats=&quot;%Y-%m-%d&quot;) ## [1] &quot;2024-01-05&quot; as.Date(&quot;2024/01/06&quot;,tryFormats=&quot;%Y/%m/%d&quot;) ## [1] &quot;2024-01-06&quot; as.Date(&quot;20240107&quot;,tryFormats=&quot;%Y%m%d&quot;) ## [1] &quot;2024-01-07&quot; 以下是常用日期格式符號 符號 說明 %Y 四位數字表示的年份（0000-9999） %y 兩個數字表示的年份（00-99） %m 兩個數字月份(01-12) %B 中文月份(七月、八月) 英文月份全名(January、February 、March) %b 中文月份(七月、八月) 英文月份縮寫(Jan，Feb，Ma) %d %e 月份中的天，取值範圍是01-31 月份中的天，取值範圍是1-31 %A 中文星期(星期六) 英文星期全名(Monday, Tuesday) ％a 中文星期(週六) 英文星期縮寫(Mon, Tue) %u 星期 1:星期一，7:星期日 %w 星期 1:星期一，0:星期日 %W 一年中的第幾個完整星期，以數字表示。這個數字是從每年的第一個星期一作為第0週來計算的 (3) as.Date 函數(數字轉日期) #as.Date(31) as.Date(31,origin=&quot;2024-01-01&quot;) ## [1] &quot;2024-02-01&quot; (4) 擷取特定日期格式 #輸出年份： format(Sys.Date(),format=&quot;%Y&quot;) ## [1] &quot;2025&quot; format(Sys.Date(),format=&quot;%y&quot;) ## [1] &quot;25&quot; #輸出月份： format(Sys.Date(),format=&quot;%m&quot;) ## [1] &quot;11&quot; format(Sys.Date(),format=&quot;%b&quot;) ## [1] &quot;十一月&quot; format(Sys.Date(),format=&quot;%B&quot;) ## [1] &quot;十一月&quot; #輸出日期： format(Sys.Date(),format=&quot;%d&quot;) ## [1] &quot;16&quot; #輸出星期： format(Sys.Date(),format=&quot;%A&quot;) ## [1] &quot;星期日&quot; format(Sys.Date(),format=&quot;%a&quot;) ## [1] &quot;週日&quot; format(Sys.Date(),format=&quot;%u&quot;) ## [1] &quot;7&quot; format(as.Date(&quot;2024-02-01&quot;),format=&quot;%w&quot;) ## [1] &quot;4&quot; #輸出週數： format(as.Date(&quot;2024-02-01&quot;),format=&quot;%W&quot;) ## [1] &quot;05&quot; (5) 時間處理 #as.POSIXlt() # 如果只有年月日的計算就是上面那種as.DATE格式 可是如果包含到時分秒 就要用到下列轉換 #as.POSIXct() #從1970年1月1日以後開始計算秒數 D1 &lt;- as.POSIXlt(&quot;2023-08-01 03:00:00&quot; ,tryFormats = c(&quot;%Y-%m-%d %H:%M:%S&quot;)) D2 &lt;- as.POSIXlt(&quot;2023-08-02 08:00:00&quot; ,tryFormats = c(&quot;%Y-%m-%d %H:%M:%S&quot;)) 以下是常用時間格式符號 符號 說明 %H 小時（24小時制） %I 小時（12小時制） %p 對於12小時制，指定上午（AM）或下午（PM） %M 分鐘 %S 秒 (6) 擷取特定時間格式 format(Sys.time(),format=&quot;%H&quot;) #輸出小時 ## [1] &quot;22&quot; format(Sys.time(),format=&quot;%M&quot;) #輸出分鐘 ## [1] &quot;23&quot; format(Sys.time(),format=&quot;%S&quot;) #輸出秒數 ## [1] &quot;29&quot; format(Sys.Date(),format=&quot;%Y年%m月%d日&quot;) ## [1] &quot;2025年11月16日&quot; format(Sys.Date(),format=&quot;西元%Y年%m月%d日&quot;) ## [1] &quot;西元2025年11月16日&quot; (7) 日期時間的加減 #單純加秒數 D1+1 ## [1] &quot;2023-08-01 03:00:01 CST&quot; #兩個日期時間相加減 D2-D1 # Time difference of 1.208333 days ## Time difference of 1.208333 days difftime(D2,D1, units = &quot;mins&quot;) #Time difference of 1740 mins ## Time difference of 1740 mins 3.3 屬性查詢與轉換 資料查詢可根據資料類型來分類 class可以查詢某物件的屬性，如下圖所示 a &lt;- &quot;dog&quot; class(a) ##屬性 純文字 (character) ## [1] &quot;character&quot; b &lt;- 380 class(b) ##屬性 數字 (numeric) ## [1] &quot;numeric&quot; c &lt;- TRUE class(c) ##屬性 邏輯值 (logical) ## [1] &quot;logical&quot; d &lt;- Sys.time() class(d) ##屬性 日期時間 (&quot;POSIXct&quot; &quot;POSIXt&quot;) ## [1] &quot;POSIXct&quot; &quot;POSIXt&quot; 3.4 運算子 運算子一般分成二類，第一類為常見用於加減乘除的算術運算子，第二類為邏輯運算子，通常根據所判斷的規則，輸出結果為TRUE 或FALSE，常與條件控制(if-else)搭配使用。 3.4.1 算術運算子 1.一般算術運算子 符號 意義 範例指令 範例結果 + 加 3+4 7 - 減 10-8 2 * 乘 5*6 30 / 除 130/5 26 ^ 指數乘冪 2^4 16 %% 餘數 78%%10 8 %/% 商數 78%/%10 7 2.特殊算術運算子 有些算術運算子，適用於矩陣的計算 符號 意義 %*% 矩陣內積乘法 %o% 矩陣外積乘法 %x% 矩陣Kronecker乘法 A = matrix(rep(c(1,2,3),2),nrow = 2,byrow=F) print (A) ## [,1] [,2] [,3] ## [1,] 1 3 2 ## [2,] 2 1 3 B = matrix(rep(c(1,2,3),2),nrow = 3,byrow=T) print (B) ## [,1] [,2] ## [1,] 1 2 ## [2,] 3 1 ## [3,] 2 3 #矩陣內積乘法 A %*% B ## [,1] [,2] ## [1,] 14 11 ## [2,] 11 14 #矩陣外積乘法 A %o% B ## , , 1, 1 ## ## [,1] [,2] [,3] ## [1,] 1 3 2 ## [2,] 2 1 3 ## ## , , 2, 1 ## ## [,1] [,2] [,3] ## [1,] 3 9 6 ## [2,] 6 3 9 ## ## , , 3, 1 ## ## [,1] [,2] [,3] ## [1,] 2 6 4 ## [2,] 4 2 6 ## ## , , 1, 2 ## ## [,1] [,2] [,3] ## [1,] 2 6 4 ## [2,] 4 2 6 ## ## , , 2, 2 ## ## [,1] [,2] [,3] ## [1,] 1 3 2 ## [2,] 2 1 3 ## ## , , 3, 2 ## ## [,1] [,2] [,3] ## [1,] 3 9 6 ## [2,] 6 3 9 #矩陣 Kronecker 乘法 A %x% B ## [,1] [,2] [,3] [,4] [,5] [,6] ## [1,] 1 2 3 6 2 4 ## [2,] 3 1 9 3 6 2 ## [3,] 2 3 6 9 4 6 ## [4,] 2 4 1 2 3 6 ## [5,] 6 2 3 1 9 3 ## [6,] 4 6 2 3 6 9 3.4.2 邏輯運算子 符號 意義 範例指令 範例結果 &lt; 小於 3&lt;4 TRUE &gt; 大於 10&gt;8 TRUE == 等於 5==6 FALSE != 不等於 5!=6 TRUE &gt;= 大於等於 10&gt;=8 TRUE &lt; = 小於等於 10&lt;=8 FALSE ! 邏輯反轉 !5==4 TRUE %in% 包含 5 %in% c(1:100) TRUE "],["資料結構.html", "Chapter 4 資料結構 4.1 資料型態相同 4.2 資料型態不同 4.3 特殊資料結構", " Chapter 4 資料結構 R的資料結構以維度來看，可區分成1維、2維及3維以上，以資料型態可分為資料同質與資料不同質。資料同質表示存放資料元素全部相同，如全是數字，或全都是文字。非同質表示可同時放數字、文字及日期等各種資料元素。實務上數據分析最常用到資料結構就是二維不同質的 data.frame 資料框，其次是一維同質的Vector 向量。而在網路爬蟲時，經常將下載好的JSON檔轉換成 三維不同質list 或是 二維不同質 data.frame，下表是根據維度及資料型態區分出的5個不同資料結構 結構\\資料型態 資料型態(相同) 資料型態(不同) 1維結構 向量(vector) – 2維結構 矩陣(matrix) 資料框(data.frame) 3維結構以上 陣列(array) 列表(list) 4.1 資料型態相同 4.1.1 一維結構(Vector) 向量(Vector)是R語言中最簡單的資料結構，語法是用c 來集合 tel &lt;- c(0912370456,0954310641,0965120744) print(tel) ## [1] 912370456 954310641 965120744 name &lt;- c(&quot;王小名&quot;,&quot;張大同&quot;) print(name) ## [1] &quot;王小名&quot; &quot;張大同&quot; 4.1.2 二維結構(matrix) matrix又稱成矩陣，可處理二維資料，是由一組相同資料元素組成，可以是一組數字、也可以是一組純文字，生成一個矩陣很簡單，使用matrix關鍵字，一共有5個參數可以設定 第一參數 data 放資料 (通常是放向量Vector) 第二參數 nrow 設定列數 第三參數 ncol 設定行數 第四參數 byrow 設定資料擺放順序是否依循row依序放入，預設為FALSE，表示是直行依序放入 第五參數 dimnames 設定列名及行名，通常用list資料型態來表示list[1]為列名(row),list[2]為行名(column) #ncol為列的設定,nrow = 行設定 matrix(data =1:28,ncol = 7,byrow = TRUE) ## [,1] [,2] [,3] [,4] [,5] [,6] [,7] ## [1,] 1 2 3 4 5 6 7 ## [2,] 8 9 10 11 12 13 14 ## [3,] 15 16 17 18 19 20 21 ## [4,] 22 23 24 25 26 27 28 使用dimnames來設定列名與行名 matrix(data =1:28,ncol = 7,byrow = TRUE, dimnames = list(c(&quot;第1週&quot;,&quot;第2週&quot;,&quot;第3週&quot;,&quot;第4週&quot;), c(&quot;星期一&quot;,&quot;星期二&quot;,&quot;星期三&quot;,&quot;星期四&quot;,&quot;星期五&quot;,&quot;星期六&quot;,&quot;星期日&quot;) )) ## 星期一 星期二 星期三 星期四 星期五 星期六 星期日 ## 第1週 1 2 3 4 5 6 7 ## 第2週 8 9 10 11 12 13 14 ## 第3週 15 16 17 18 19 20 21 ## 第4週 22 23 24 25 26 27 28 4.1.3 三維結構 (array) 陣列array能處理三維以上資料，同樣由一組相同資料元素組成,使用array關鍵字生成一個陣列，與matrix不同，array只有3個參數可以設定(無ncol、nrow及byrow參數)，數字擺放順序都是依垂直行放入，相關參數說明如下: 第一參數 data 放資料 (通常是放向量Vector) 第二參數 dim 設定 列數、行數及第三緯度以上數量 第三參數 dimnames 設定列名及行名等，以list資料型態來表示list[1]為列名(row),list[2]為行名(column),list[3]放第三維度以後的名稱 3維的array array(1:24,c(3,4,2), dimnames = list(產品=c(&quot;紅茶&quot;,&quot;綠茶&quot;,&quot;烏龍茶&quot;), 月份=c(&quot;1月&quot;,&quot;2月&quot;,&quot;3月&quot;,&quot;4月&quot;), 區域=c(&quot;東區&quot;,&quot;西區&quot;) )) ## , , 區域 = 東區 ## ## 月份 ## 產品 1月 2月 3月 4月 ## 紅茶 1 4 7 10 ## 綠茶 2 5 8 11 ## 烏龍茶 3 6 9 12 ## ## , , 區域 = 西區 ## ## 月份 ## 產品 1月 2月 3月 4月 ## 紅茶 13 16 19 22 ## 綠茶 14 17 20 23 ## 烏龍茶 15 18 21 24 4維的array array(1:36,c(3,3,2,2), dimnames = list(產品=c(&quot;第一季&quot;,&quot;第二季&quot;,&quot;第三季&quot;), 月份=c(&quot;紅茶&quot;,&quot;綠茶&quot;,&quot;烏龍茶&quot;), 區域=c(&quot;東區&quot;,&quot;西區&quot;), 縣市=c(&quot;台中&quot;,&quot;台北&quot;) )) ## , , 區域 = 東區, 縣市 = 台中 ## ## 月份 ## 產品 紅茶 綠茶 烏龍茶 ## 第一季 1 4 7 ## 第二季 2 5 8 ## 第三季 3 6 9 ## ## , , 區域 = 西區, 縣市 = 台中 ## ## 月份 ## 產品 紅茶 綠茶 烏龍茶 ## 第一季 10 13 16 ## 第二季 11 14 17 ## 第三季 12 15 18 ## ## , , 區域 = 東區, 縣市 = 台北 ## ## 月份 ## 產品 紅茶 綠茶 烏龍茶 ## 第一季 19 22 25 ## 第二季 20 23 26 ## 第三季 21 24 27 ## ## , , 區域 = 西區, 縣市 = 台北 ## ## 月份 ## 產品 紅茶 綠茶 烏龍茶 ## 第一季 28 31 34 ## 第二季 29 32 35 ## 第三季 30 33 36 4.2 資料型態不同 4.2.1 二維結構 (data.frame) data.frame類似excel中的活頁簿，row 為橫行，column為直列，每一個column為一個變數或一個欄位，每一個row 為一筆資料。 一般csv檔，可以很輕鬆用read.csv函數，將資料匯入成data.frame DT &lt;- read.csv(&quot;./data/C0G660-2024-09-27.csv&quot;) head(DT) ## 觀測時間.hour. 測站氣壓.hPa. 氣溫... 相對溼度... 風速.m.s. ## 1 ObsTime StnPres Temperature RH WS ## 2 01 1007.0 28.7 100 0.0 ## 3 02 1006.8 28.5 100 0.2 ## 4 03 1006.3 28.3 100 0.0 ## 5 04 1006.8 28.3 100 0.0 ## 6 05 1006.7 28.2 100 0.0 ## 風向.360degree. 最大瞬間風.m.s. 最大瞬間風風向.360degree. 降水量.mm. ## 1 WD WSGust WDGust Precp ## 2 0 2.5 339 0.0 ## 3 0 1.6 351 0.0 ## 4 0 1.8 360 0.0 ## 5 0 0.0 0 0.0 ## 6 0 1.6 342 0.0 可以使用data.frame() 函數，自創data.frame 資料結構 score &lt;- data.frame(&quot;CLASS&quot; = rep(c(&quot;甲班&quot;,&quot;乙班&quot;,&quot;丙班&quot;), each = 10) , # 班級 &quot;SEX&quot; = sample(c(&quot;男&quot;,&quot;女&quot;),30,replace = T), #性別 &quot;AREA&quot; = sample(c(&quot;興和里&quot;,&quot;復興里&quot;,&quot;瑞興里&quot;,&quot;仁善里&quot;),30,replace = T), #居住里 &quot;CS&quot; = sample(30:80,30,replace = T), # 國文成績 &quot;ES&quot; = sample(50:100,30,replace = T),# 英文成績 &quot;MS&quot; = sample(40:90,30,replace = T) # 數學成績 ) 3.前幾筆查看 /後幾筆查看 用head()，可以查看前幾筆資料，預設查看前5筆;用tail()，可以查看最後幾筆資料，預設也是查看最後5筆 # 查看前5筆 head(score) ## CLASS SEX AREA CS ES MS ## 1 甲班 女 興和里 62 78 72 ## 2 甲班 女 興和里 43 73 69 ## 3 甲班 女 仁善里 46 89 61 ## 4 甲班 女 興和里 73 73 81 ## 5 甲班 女 仁善里 69 51 89 ## 6 甲班 女 復興里 71 54 90 # 查看最後5筆 tail(score) ## CLASS SEX AREA CS ES MS ## 25 丙班 女 瑞興里 53 93 80 ## 26 丙班 男 瑞興里 40 88 69 ## 27 丙班 男 瑞興里 57 79 51 ## 28 丙班 女 仁善里 40 56 47 ## 29 丙班 女 瑞興里 79 70 52 ## 30 丙班 女 復興里 37 72 41 # 查看前10筆 head(score ,n=10) ## CLASS SEX AREA CS ES MS ## 1 甲班 女 興和里 62 78 72 ## 2 甲班 女 興和里 43 73 69 ## 3 甲班 女 仁善里 46 89 61 ## 4 甲班 女 興和里 73 73 81 ## 5 甲班 女 仁善里 69 51 89 ## 6 甲班 女 復興里 71 54 90 ## 7 甲班 女 興和里 51 75 55 ## 8 甲班 男 復興里 49 72 80 ## 9 甲班 女 瑞興里 57 62 55 ## 10 甲班 女 興和里 47 82 46 data.frame 行與列 之 數量查詢 可用nrow()查看data.frame共有多少筆數(行數)，用ncol()查看變數的數量(列數)，用dim()同時查看幾行幾列 # 查詢行數 nrow(score) ## [1] 30 # 查詢列數 ncol(score) ## [1] 6 # 查詢行數與列數 dim(score) ## [1] 30 6 5.屬性查看 先前教過使用class可以查看某向量屬於哪種資料類型(文字、數值、日期)，但是class一次只能查看一種資料， 而data.frame是一個擁有很多欄位(很多屬性)的複雜物件，所以可改用str()來查看資料整體屬性。 # 查詢行數 str(score) ## &#39;data.frame&#39;: 30 obs. of 6 variables: ## $ CLASS: chr &quot;甲班&quot; &quot;甲班&quot; &quot;甲班&quot; &quot;甲班&quot; ... ## $ SEX : chr &quot;女&quot; &quot;女&quot; &quot;女&quot; &quot;女&quot; ... ## $ AREA : chr &quot;興和里&quot; &quot;興和里&quot; &quot;仁善里&quot; &quot;興和里&quot; ... ## $ CS : int 62 43 46 73 69 71 51 49 57 47 ... ## $ ES : int 78 73 89 73 51 54 75 72 62 82 ... ## $ MS : int 72 69 61 81 89 90 55 80 55 46 ... 6.查詢欄位名/行名 # 查詢欄位名 colnames(score) # 也可使用 names(score) ## [1] &quot;CLASS&quot; &quot;SEX&quot; &quot;AREA&quot; &quot;CS&quot; &quot;ES&quot; &quot;MS&quot; # 查詢行名 rownames(score) ## [1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; &quot;6&quot; &quot;7&quot; &quot;8&quot; &quot;9&quot; &quot;10&quot; &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot; &quot;15&quot; ## [16] &quot;16&quot; &quot;17&quot; &quot;18&quot; &quot;19&quot; &quot;20&quot; &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot; &quot;29&quot; &quot;30&quot; 7.變更欄位名稱 # 變更所有欄位名稱 colnames(score) &lt;- c(&quot;班級&quot;,&quot;性別&quot;, &quot;居住&quot; , &quot;國文&quot;, &quot;英文&quot;,&quot;數學&quot;) # 變更某一個欄位名稱 colnames(score)[4] &lt;- &quot;國文成績&quot; # 重新查看欄位名稱 names(score) ## [1] &quot;班級&quot; &quot;性別&quot; &quot;居住&quot; &quot;國文成績&quot; &quot;英文&quot; &quot;數學&quot; colnames(score)[4] &lt;-&quot;國文&quot; 8.提取data.frame某欄某行資料 data.frame，用中括弧[,]來找出行列內容,第一個引數代表rows數，第二個引數代表column數，第二個引數數字代表某欄位順序，也可以直接輸入變數名稱直接提取資料出來，此外data.frame+$+變數名稱，可以提取整欄資料 score[3,] #提取第三位同學整筆資料 ## 班級 性別 居住 國文 英文 數學 ## 3 甲班 女 仁善里 46 89 61 score[,5] #提取第5欄資料，英文成績 ## [1] 78 73 89 73 51 54 75 72 62 82 54 67 99 89 69 66 95 99 79 97 74 76 75 86 93 ## [26] 88 79 56 70 72 score[c(9,2,18,15),] #提取第9,2,18,15位同學整筆資料 ## 班級 性別 居住 國文 英文 數學 ## 9 甲班 女 瑞興里 57 62 55 ## 2 甲班 女 興和里 43 73 69 ## 18 乙班 男 復興里 44 99 66 ## 15 乙班 女 仁善里 41 69 40 score[,c(1,2,5)] #提取第1,2,5欄資料(班級 性別 英文) ## 班級 性別 英文 ## 1 甲班 女 78 ## 2 甲班 女 73 ## 3 甲班 女 89 ## 4 甲班 女 73 ## 5 甲班 女 51 ## 6 甲班 女 54 ## 7 甲班 女 75 ## 8 甲班 男 72 ## 9 甲班 女 62 ## 10 甲班 女 82 ## 11 乙班 女 54 ## 12 乙班 女 67 ## 13 乙班 男 99 ## 14 乙班 男 89 ## 15 乙班 女 69 ## 16 乙班 男 66 ## 17 乙班 男 95 ## 18 乙班 男 99 ## 19 乙班 男 79 ## 20 乙班 男 97 ## 21 丙班 男 74 ## 22 丙班 女 76 ## 23 丙班 男 75 ## 24 丙班 男 86 ## 25 丙班 女 93 ## 26 丙班 男 88 ## 27 丙班 男 79 ## 28 丙班 女 56 ## 29 丙班 女 70 ## 30 丙班 女 72 score[1:2,1:4] #指定某範圍的資料提取 ## 班級 性別 居住 國文 ## 1 甲班 女 興和里 62 ## 2 甲班 女 興和里 43 score[,c(&quot;班級&quot;,&quot;英文&quot;)] # 可直接鍵入變數名稱提取某欄位完整資料 ## 班級 英文 ## 1 甲班 78 ## 2 甲班 73 ## 3 甲班 89 ## 4 甲班 73 ## 5 甲班 51 ## 6 甲班 54 ## 7 甲班 75 ## 8 甲班 72 ## 9 甲班 62 ## 10 甲班 82 ## 11 乙班 54 ## 12 乙班 67 ## 13 乙班 99 ## 14 乙班 89 ## 15 乙班 69 ## 16 乙班 66 ## 17 乙班 95 ## 18 乙班 99 ## 19 乙班 79 ## 20 乙班 97 ## 21 丙班 74 ## 22 丙班 76 ## 23 丙班 75 ## 24 丙班 86 ## 25 丙班 93 ## 26 丙班 88 ## 27 丙班 79 ## 28 丙班 56 ## 29 丙班 70 ## 30 丙班 72 score$班級 # $+變數名稱可以提取某變數完整資料 ## [1] &quot;甲班&quot; &quot;甲班&quot; &quot;甲班&quot; &quot;甲班&quot; &quot;甲班&quot; &quot;甲班&quot; &quot;甲班&quot; &quot;甲班&quot; &quot;甲班&quot; &quot;甲班&quot; ## [11] &quot;乙班&quot; &quot;乙班&quot; &quot;乙班&quot; &quot;乙班&quot; &quot;乙班&quot; &quot;乙班&quot; &quot;乙班&quot; &quot;乙班&quot; &quot;乙班&quot; &quot;乙班&quot; ## [21] &quot;丙班&quot; &quot;丙班&quot; &quot;丙班&quot; &quot;丙班&quot; &quot;丙班&quot; &quot;丙班&quot; &quot;丙班&quot; &quot;丙班&quot; &quot;丙班&quot; &quot;丙班&quot; 資料合併 rbind()可以合併有相同變數的data.frame的資料，增加筆數 cbind()可以合併有相同筆數的data.frame的資料，增加變數 #增加筆數 addRow &lt;- c(&quot;甲班&quot; , &quot;女&quot;, &quot;興和里&quot; , &quot;42&quot; , &quot;83&quot; , &quot;57&quot;) rbind(score,addRow) ## 班級 性別 居住 國文 英文 數學 ## 1 甲班 女 興和里 62 78 72 ## 2 甲班 女 興和里 43 73 69 ## 3 甲班 女 仁善里 46 89 61 ## 4 甲班 女 興和里 73 73 81 ## 5 甲班 女 仁善里 69 51 89 ## 6 甲班 女 復興里 71 54 90 ## 7 甲班 女 興和里 51 75 55 ## 8 甲班 男 復興里 49 72 80 ## 9 甲班 女 瑞興里 57 62 55 ## 10 甲班 女 興和里 47 82 46 ## 11 乙班 女 仁善里 73 54 77 ## 12 乙班 女 仁善里 40 67 65 ## 13 乙班 男 復興里 69 99 88 ## 14 乙班 男 興和里 52 89 65 ## 15 乙班 女 仁善里 41 69 40 ## 16 乙班 男 復興里 53 66 66 ## 17 乙班 男 仁善里 37 95 76 ## 18 乙班 男 復興里 44 99 66 ## 19 乙班 男 瑞興里 56 79 41 ## 20 乙班 男 復興里 47 97 56 ## 21 丙班 男 瑞興里 40 74 69 ## 22 丙班 女 興和里 38 76 67 ## 23 丙班 男 興和里 69 75 56 ## 24 丙班 男 仁善里 68 86 52 ## 25 丙班 女 瑞興里 53 93 80 ## 26 丙班 男 瑞興里 40 88 69 ## 27 丙班 男 瑞興里 57 79 51 ## 28 丙班 女 仁善里 40 56 47 ## 29 丙班 女 瑞興里 79 70 52 ## 30 丙班 女 復興里 37 72 41 ## 31 甲班 女 興和里 42 83 57 #增加欄位 &quot;自然&quot; &lt;- sample(50:100,30,replace = T) score &lt;- cbind(score,自然) head(score) ## 班級 性別 居住 國文 英文 數學 自然 ## 1 甲班 女 興和里 62 78 72 67 ## 2 甲班 女 興和里 43 73 69 94 ## 3 甲班 女 仁善里 46 89 61 92 ## 4 甲班 女 興和里 73 73 81 89 ## 5 甲班 女 仁善里 69 51 89 59 ## 6 甲班 女 復興里 71 54 90 92 善用$和賦值，也可以新增變數 #增加欄位 score$社會 &lt;- sample(50:100,30,replace = T) head(score) ## 班級 性別 居住 國文 英文 數學 自然 社會 ## 1 甲班 女 興和里 62 78 72 67 52 ## 2 甲班 女 興和里 43 73 69 94 52 ## 3 甲班 女 仁善里 46 89 61 92 79 ## 4 甲班 女 興和里 73 73 81 89 100 ## 5 甲班 女 仁善里 69 51 89 59 70 ## 6 甲班 女 復興里 71 54 90 92 56 4.2.2 三維結構 (list) list 和 data.frame 最大差別是data.frame屬於二維資料，而list屬於三維資料，list可以儲存各種資料類型， 甚至可以儲存data.frame 建立list，使用list() #建立list DT &lt;- list(&quot;考試日期&quot; =Sys.Date() ,&quot;考試類型&quot; = &quot;期中考試&quot; ,Score =score[1:10,]) 資料提取 list可用$，提取每一個向度資料，亦可使用中括弧[]，提取某向度資料 DT[1] #使用[]提取 ## $考試日期 ## [1] &quot;2025-11-16&quot; DT[2] #使用[]提取 ## $考試類型 ## [1] &quot;期中考試&quot; DT$Score #使用$提取 ## 班級 性別 居住 國文 英文 數學 自然 社會 ## 1 甲班 女 興和里 62 78 72 67 52 ## 2 甲班 女 興和里 43 73 69 94 52 ## 3 甲班 女 仁善里 46 89 61 92 79 ## 4 甲班 女 興和里 73 73 81 89 100 ## 5 甲班 女 仁善里 69 51 89 59 70 ## 6 甲班 女 復興里 71 54 90 92 56 ## 7 甲班 女 興和里 51 75 55 96 73 ## 8 甲班 男 復興里 49 72 80 61 55 ## 9 甲班 女 瑞興里 57 62 55 68 98 ## 10 甲班 女 興和里 47 82 46 66 82 DT[3] 和DT[[3]] 差別，list的DT第三個向度是data.frame，若是想向下繼續擷取行列內容時， 就需要兩個中括弧[[]]，先將data.frame提取出來，之後再用[]選擇想要行列擷取出來 DT[3][2] #單個中括弧，無法擷取將data.frame內部某欄資訊 ## $&lt;NA&gt; ## NULL DT[[3]][2] ## 性別 ## 1 女 ## 2 女 ## 3 女 ## 4 女 ## 5 女 ## 6 女 ## 7 女 ## 8 男 ## 9 女 ## 10 女 DT[[3]][6:10,1:5] ## 班級 性別 居住 國文 英文 ## 6 甲班 女 復興里 71 54 ## 7 甲班 女 興和里 51 75 ## 8 甲班 男 復興里 49 72 ## 9 甲班 女 瑞興里 57 62 ## 10 甲班 女 興和里 47 82 4.3 特殊資料結構 4.3.1 列聯表 R內建一些函數，可以計算統計意思上列聯表，也就是資料集各種分類組合的發生次數，發生百分比 4.3.1.1 table()函數 用法 table(X1,X2,...,Xk,dnn) x1~xk :為factor、list或data.frame變數 dnn: 設定各維度名稱 範例1 以鳶尾花卉資料集(iris)為例，使用table()，可以查出不同花品種出現次數 # 載入資料集 data(iris) # 查看資料集的前幾行 head(iris) ## Sepal.Length Sepal.Width Petal.Length Petal.Width Species ## 1 5.1 3.5 1.4 0.2 setosa ## 2 4.9 3.0 1.4 0.2 setosa ## 3 4.7 3.2 1.3 0.2 setosa ## 4 4.6 3.1 1.5 0.2 setosa ## 5 5.0 3.6 1.4 0.2 setosa ## 6 5.4 3.9 1.7 0.4 setosa #使用 table() 函數查出不同花品種出現次數 table(iris$Species) ## ## setosa versicolor virginica ## 50 50 50 範例2 使用table()計算CO2 資料集中兩個分類組合(植物類型VS 施肥方式)的發生次數 。 CO2 資料集包含以下變數： Plant: 植物的識別編號 Type: 植物類型（ Quebec 和 Mississippi） Treatment: 施肥方式（chilled 或 nonchilled） conc: 二氧化碳濃度（以毫升/升為單位） uptake: 植物對二氧化碳的吸收量（以微克/平方厘米為單位）。 # 載入資料集 data(CO2) # 查看資料集的前幾行 head(CO2) ## Plant Type Treatment conc uptake ## 1 Qn1 Quebec nonchilled 95 16.0 ## 2 Qn1 Quebec nonchilled 175 30.4 ## 3 Qn1 Quebec nonchilled 250 34.8 ## 4 Qn1 Quebec nonchilled 350 37.2 ## 5 Qn1 Quebec nonchilled 500 35.3 ## 6 Qn1 Quebec nonchilled 675 39.2 # 使用 table() 函數分析植物類型和處理的關係 tab1 &lt;- table(CO2$Type, CO2$Treatment,dnn = c(&quot;植物類型&quot;,&quot;施肥方式&quot;)) tab1 ## 施肥方式 ## 植物類型 nonchilled chilled ## Quebec 21 21 ## Mississippi 21 21 class(tab1) ## [1] &quot;table&quot; 4.3.1.2 margin.table() margin.table()，可計算列聯表的行與列個別加總，用法 margin.table(x, margin) x: table 或 array margin : 1= rows邊際加總; 2= columns邊際加總 #rows邊際加總 margin.table(tab1,1) # 等同 rowSums(tab1) ## 植物類型 ## Quebec Mississippi ## 42 42 #columns邊際加總 margin.table(tab1,2) # 等同 colSums(tab1) ## 施肥方式 ## nonchilled chilled ## 42 42 4.3.1.3 prop.table() prop.table()，可計算列聯表的行與列之比例，用法 prop.table(x, margin) x: table margin : 1= rows比例; 2= columns比例 #rows邊際比例 prop.table(tab1,1) ## 施肥方式 ## 植物類型 nonchilled chilled ## Quebec 0.5 0.5 ## Mississippi 0.5 0.5 #columns邊際比例 prop.table(tab1,2) ## 施肥方式 ## 植物類型 nonchilled chilled ## Quebec 0.5 0.5 ## Mississippi 0.5 0.5 4.3.1.4 ftable() ftable()類似table()功能，但會依其分類變數進行扁平化，以Arthritis資料集為例， 使用table()或ftable()處理三個分類變項時，會有不同呈現結果 Treatment : 組別 (Treated 治療組、Placebo 安慰劑組) Sex: 性別(Male男、Female女) Improved: 治療結果(None無改善、Some一點改善、Marked顯著改善) # 載入vcd套件中的Arthritis資料集 data(Arthritis,package = &quot;vcd&quot;) # 查看資料集的前幾行 head(Arthritis) ## ID Treatment Sex Age Improved ## 1 57 Treated Male 27 Some ## 2 46 Treated Male 29 None ## 3 77 Treated Male 30 None ## 4 17 Treated Male 32 Marked ## 5 36 Treated Male 46 Marked ## 6 23 Treated Male 58 Marked # 使用table() table(Arthritis$Sex,Arthritis$Improved,Arthritis$Treatment ,dnn = c(&quot;性別&quot;,&quot;治療結果&quot;,&quot;組別&quot;) ) ## , , 組別 = Placebo ## ## 治療結果 ## 性別 None Some Marked ## Female 19 7 6 ## Male 10 0 1 ## ## , , 組別 = Treated ## ## 治療結果 ## 性別 None Some Marked ## Female 6 5 16 ## Male 7 2 5 # 使用ftable() ftable(Arthritis$Sex,Arthritis$Improved,Arthritis$Treatment,dnn = c(&quot;性別&quot;,&quot;治療結果&quot;,&quot;組別&quot;)) ## 組別 Placebo Treated ## 性別 治療結果 ## Female None 19 6 ## Some 7 5 ## Marked 6 16 ## Male None 10 7 ## Some 0 2 ## Marked 1 5 "],["資料輸入與輸出.html", "Chapter 5 資料輸入與輸出 5.1 資料鍵入與印出 5.2 複製及貼上 5.3 資料匯入 5.4 資料匯出", " Chapter 5 資料輸入與輸出 5.1 資料鍵入與印出 5.1.1 資料鍵入 在 R 語言中，當我們需要讓使用者從鍵盤輸入資料時，最常用的基礎函數就是 scan() 和 readline() scan()：常用於從標準輸入（鍵盤）或文件中讀取一連串相同類型的資料，並將其儲存為一個向量 (Vector)。 # 範例一：輸入數字向量 ages &lt;- scan() # 預設讀取數字 (依序輸入數值，完成後請按兩次 Enter)&quot; print(&quot;您輸入的資料為：&quot;) print(ages) # 範例二：輸入文字向量 # 指定讀取文字(依序輸入三個最喜歡的水果，完成後請按兩次 Enter) fruits &lt;- scan(what = character()) print(&quot;您喜歡的水果列表：&quot;) print(favorite_fruits) readline(\"請輸入字串:\")：用於提示使用者輸入一段文字，並將整行輸入作為一個單一的字串 (character string) 儲存。 5.1.2 資料印出 print() 和cat()，都可以把資料打印到Console螢幕上 print()只能輸出一個完整文字訊息，如果想要利用print() 輸出一段話+某變數，就必須另外使用paste()或paste0()將兩個訊息結合成一個完整文字訊息才能用print()進行輸出。 但cat()可直接用”,” 來結合文字或物件即可輸出，範例如下: cat() name = &quot;Lucy&quot; cat( name ,&quot;帶狗狗去公園散步了&quot; ) ## Lucy 帶狗狗去公園散步了 print() name = &quot;Lucy&quot; print( paste(name ,&quot;帶狗狗去公園散步了&quot;) ) ## [1] &quot;Lucy 帶狗狗去公園散步了&quot; 5.2 複製及貼上 有兩個套件，可以輕鬆將R輸出結果轉化到剪貼簿後，就可以直接拿到Excel或Word中複製貼上，相當方便，clipr 套件基本不用再安裝，因為已經常規預設安中好 #A.把 clipboard 中（你已經複製好）的內容存在 text 變數中 text &lt;-clipr::read_clip() ##轉換成純文字向量(適合單行貼上) DT &lt;-clipr::read_clip_tbl() ##轉換成data.frame(適合表格貼上) #B.本該輸出至Console的內容暫存到 clipboard 容器，就可以貼到別處(例如Excel) clipr::write_clip(text) 另一個好用套件是psychTools #另一個好用套件 library(psychTools) text&lt;-psychTools::read.clipboard() text&lt;-psychTools::read.clipboard.tab() 5.3 資料匯入 可從RStudio 工具列 選擇 不同檔案格式 匯入，亦可輸入指令匯入 5.3.1 匯入csv檔 library(readr) #呼叫csv檔的套件 # 方法1：使用 R 內建的 read.csv() score = read.csv(&quot;./data/score.csv&quot;, sep=&quot;,&quot;, header=TRUE, stringsAsFactors=FALSE) head(score) # 方法2：使用 readr 套件的 read_csv() - 速度更快，處理大檔案更有效率 score2 = read_csv(&quot;./data/score.csv&quot;) head(score2) # 方法3：讀取有中文編碼的csv檔 score3 = read.csv(&quot;./data/score.csv&quot;, fileEncoding=&quot;UTF-8&quot;) # 或 &quot;BIG5&quot; head(score3) 5.3.2 匯入excel檔 library(readxl) #呼叫excel檔的套件 # 讀取第一個工作表 data1 = read_excel(&quot;data/datasets.xlsx&quot;) head(data1) # 讀取指定工作表 - 透過名稱 data2 = read_excel(&quot;data/datasets.xlsx&quot;, sheet = &quot;iris&quot;) head(data2) # 讀取指定工作表 - 透過索引 data3 = read_excel(&quot;data/datasets.xlsx&quot;, sheet = 2) head(data3) # 讀取指定範圍的資料 data4 = read_excel(&quot;data/datasets.xlsx&quot;, range = &quot;A1:C10&quot;) head(data4) # 跳過前幾行 data5 = read_excel(&quot;data/datasets.xlsx&quot;, skip = 2) head(data5) 5.3.3 匯入json檔 library(jsonlite) # 處理JSON格式資料的套件 # 從本地檔案讀取JSON資料 json_data = fromJSON(&quot;data/198_5.json&quot;) str(json_data) # 查看資料結構 # 從URL讀取JSON資料 api_data = fromJSON(&quot;https://www-ws.pthg.gov.tw/Upload/2015pthg/0/relfile/0/0/ccb3a5fd-4754-4be4-96be-df1f50367f47.json&quot;) head(api_data) # 如果JSON資料是巢狀結構，可以使用flatten參數 # flat_data = fromJSON(&quot;data/data.json&quot;, flatten=TRUE) # str(flat_data) # 自建JSON格式 string = &#39;{&quot;name&quot;:&quot;John&quot;, &quot;age&quot;:30, &quot;city&quot;:&quot;New York&quot;}&#39; parsed_data = fromJSON(string) print(parsed_data) 5.3.4 匯入RDS檔 或載入多個R物件 RDS檔是R專有的檔案格式，具有檔案小速度快特性，而RData是多個R物件的組合檔 # 讀取RDS檔案 mtcars = readRDS(&quot;data/mtcars.rds&quot;) # 載入RData檔案 load(&quot;data/my_data.RData&quot;) 5.4 資料匯出 5.4.1 匯出為csv檔 # 方法1：使用 base R 的 write.csv() write.csv(mtcars, &quot;data/output/mtcars1.csv&quot;, row.names=FALSE) # 方法2：使用 readr 套件的 write_csv() - 速度更快 library(readr) write_csv(mtcars, &quot;data/output/mtcars2.csv&quot;) # 方法3：處理中文編碼 write.csv(mtcars, &quot;data/output/mtcars3.csv&quot;, row.names=FALSE, fileEncoding=&quot;UTF-8&quot;) 5.4.2 匯出為excel檔 要匯出 Excel，建議使用 openxlsx 或 writexl 套件。 5.4.2.1 方法 1：使用 writexl install.packages(&quot;writexl&quot;) #安裝 writexl套件 library(writexl) # 函數參數介紹 write_xlsx( x, # 要輸出的資料（data frame 或 list of data frames） path = tempfile(fileext = &quot;.xlsx&quot;), # 輸出檔案路徑（預設為暫存檔） col_names = TRUE, # 是否輸出欄位名稱 format_headers = TRUE, # 是否格式化欄位名稱（如粗體） use_zip64 = FALSE # 是否使用 ZIP64（處理超大 Excel 檔案） ) # 簡單匯出excel write_xlsx(iris, &quot;data/output/iris1.xlsx&quot;) #################################################### #1. 假設有兩個 Data Frame: result_A 和 result_B result_A &lt;- data.frame(ID = 1:3, Value = c(10, 20, 30)) result_B &lt;- data.frame(Group = c(&quot;X&quot;, &quot;Y&quot;), Mean = c(5.5, 8.2)) #2. 使用 list() 將多個 Data Frame 組合成一個列表，並指定每個工作表的名稱 data_list &lt;- list( &quot;Result_Set_A&quot; = result_A, # 第一個工作表名稱為 Result_Set_A &quot;Result_Set_B&quot; = result_B # 第二個工作表名稱為 Result_Set_B ) #3. 使用 write_xlsx() 寫入 Excel 檔案 write_xlsx( x = data_list, path = &quot;data/output/analysis_summary.xlsx&quot; ) 5.4.2.2 方法 2：使用 openxlsx openxlsx有豐富的函式，可以客製化輸出一些特殊的格式 library(openxlsx) # 方法1 :簡單匯出excel data(iris) # 載入 iris 資料集 write.xlsx(iris, file = &quot;data/output/iris.xlsx&quot;) # 方法2 : 另一種方式 # 建立新的Excel工作簿 wb = createWorkbook() # 添加工作表並寫入資料 addWorksheet(wb, &quot;mtcars數據&quot;) writeData(wb, sheet=&quot;mtcars數據&quot;, mtcars) # 儲存Excel檔案 saveWorkbook(wb, &quot;data/output/mtcars.xlsx&quot;, overwrite=TRUE) 5.4.3 匯出為json檔 library(jsonlite) # 將資料框轉換為JSON格式並儲存 json_data = toJSON(mtcars, pretty=TRUE) write(json_data, &quot;data/output/mtcars.json&quot;) # 直接將物件轉為JSON並寫入檔案 write_json(mtcars, &quot;data/output/mtcars2.json&quot;, pretty=TRUE) 5.4.4 匯出為R資料格式 # 儲存單一物件為RDS格式 saveRDS(mtcars, &quot;data/output/mtcars.rds&quot;) # 儲存多個物件為RData格式 save(iris, mtcars, file=&quot;data/output/my_data.RData&quot;) "],["流程控制.html", "Chapter 6 流程控制 6.1 if -else 邏輯判斷 6.2 for 迴圈 6.3 while 迴圈 6.4 repeat 迴圈 6.5 break與next", " Chapter 6 流程控制 6.1 if -else 邏輯判斷 ifelse() ifelse是最簡單的邏輯判斷，寫法類似excel函數if函數，第一參數放判斷句，第二參數放判斷為真(TRUE)，會執行的程式碼，第三參數放判斷為假(FALSE)，會執行的程式碼 num &lt;- c(7,8,10,65,6,8,35,15,25,9,22) ifelse(num&gt;=10,&quot;&gt;=10&quot;,&quot;&lt;10&quot;) ## [1] &quot;&lt;10&quot; &quot;&lt;10&quot; &quot;&gt;=10&quot; &quot;&gt;=10&quot; &quot;&lt;10&quot; &quot;&lt;10&quot; &quot;&gt;=10&quot; &quot;&gt;=10&quot; &quot;&gt;=10&quot; &quot;&lt;10&quot; ## [11] &quot;&gt;=10&quot; if() 或 if()-else() 雖然ifelse很好用，但僅適用於單行邏輯判斷或執行，當預計執行程式碼較為複雜，無法用一行程式碼來執行，就必須考慮 使用if 及 else() if-else敘述使用在邏輯判斷，若需要依條件改變需要執行的程式碼，就會使用if-else，若if後所接邏輯判斷為真(TRUE)，就會執行if下方之程式碼，若為偽(FALSE)，則執行else下方之程式碼，若程式中沒有else片段，則不執行任何程式碼。 X =30 if(X&gt;=60){ print( &quot;及格&quot; ) }else{ print( &quot;不及格&quot;) } ## [1] &quot;不及格&quot; if- else if -else 當條件判斷是超過三個以上，中間條件判斷可以使用 else if 來判斷，最後一個則用else即可 X=sample(1:30,1) if(X %in% 3:5){ print(paste(&quot;X=&quot;,X,&quot;,春天&quot;)) }else if(X %in% 6:8){ print(paste (&quot;X=&quot;,X,&quot;夏天&quot;)) }else if(X %in% 9:11){ print(paste (&quot;X=&quot;,X,&quot;秋天&quot;)) }else if (X %in% c(1,2,12)){ print(paste(&quot;X=&quot;,X,&quot;冬天&quot;)) }else {print(paste (&quot;X=&quot;,X,&quot;請輸入1-12數字&quot;))} ## [1] &quot;X= 13 請輸入1-12數字&quot; 6.2 for 迴圈 for(i in c(&quot;蘋果&quot;,&quot;香蕉&quot;,&quot;西瓜&quot;)){ text &lt;- paste(&quot;這是&quot;,i ) print (text) } ## [1] &quot;這是 蘋果&quot; ## [1] &quot;這是 香蕉&quot; ## [1] &quot;這是 西瓜&quot; 6.3 while 迴圈 在R語言中，while迴圈用於在條件為真時重複執行一段程式碼。 while迴圈的基本語法結構如下，在每次迭代之前，R會檢查括號中的條件是否為真。如果為真，則執行迴圈內的程式碼；如果為假，則退出迴圈。 while (條件) { # 每次迭代要執行的程式碼 } 以下是一個使用while迴圈的範例，這段程式碼將輸出月份名稱： i &lt;- 1 while (i &lt;= 5) { print(month.name[i]) i &lt;- i + 1 } ## [1] &quot;January&quot; ## [1] &quot;February&quot; ## [1] &quot;March&quot; ## [1] &quot;April&quot; ## [1] &quot;May&quot; 6.4 repeat 迴圈 在R語言中，repeat迴圈用於重複執行一段程式碼，直到滿足特定的停止條件。這種迴圈的特點是沒有內建的條件來退出，必須使用break語句來明確地終止迴圈。 repeat { # 執行的程式碼 if (停止條件) { break } } 範例:打印數字直到達到特定值 # 展示如何使用repeat迴圈從1打印到5 x &lt;- 1 repeat { print(x) if (x &gt;= 5) { break } x &lt;- x + 1 } ## [1] 1 ## [1] 2 ## [1] 3 ## [1] 4 ## [1] 5 6.5 break與next 在 R 語言中，break 和 next 是用於控制迴圈流的兩個關鍵字。 break: 用於立即終止最內層的迴圈，不會影響外層的執行。 next: 跳過當前最內層迴圈的剩餘程式碼，直接進入下一次迭代。 範例: break # 使用 break 退出迴圈 for (i in 1:10) { if (i == 5) { break # 當 i 等於 5 時退出迴圈 } print(i) # 打印 i } ## [1] 1 ## [1] 2 ## [1] 3 ## [1] 4 範例: next # 使用 next 跳過某些值 for (i in 1:10) { if (i %% 2 == 0) { next # 當 i 是偶數時跳過這次迭代 } print(i) # 打印 i } ## [1] 1 ## [1] 3 ## [1] 5 ## [1] 7 ## [1] 9 "],["函數介紹.html", "Chapter 7 函數介紹 7.1 R 語言常用內建函數分類 7.2 實用套件之函數 7.3 自訂函數 7.4 do.call 及call", " Chapter 7 函數介紹 7.1 R 語言常用內建函數分類 R 語言的核心系統 (Base R) 提供了豐富的內建函數（Built-in Functions），這些函數是處理資料、執行運算和進行統計分析的基礎工具。它們可以被大致分為以下幾類： 函數種類 主要功能 常用內建函數 (範例) 數學運算 (Mathematical) 執行數值計算和數學轉換 abs() (絕對值)、sqrt() (平方根)、log() (對數)、exp() (指數)、round() (四捨五入)、ceiling() (無條件進位)、floor() (無條件捨去)、sin()、cos() (三角函數) 敘述統計 (Descriptive Statistics) 快速計算數據集的摘要統計量 sum() (總和)、mean() (平均值)、median() (中位數)、sd() (標準差)、var() (變異數)、min() (最小值)、max() (最大值)、range() (範圍)、quantile() (分位數) 資料結構/管理 (Data Management) 建立、操作或檢查 R 的資料物件 c() (連接向量或列表)、length() (求長度)、seq() (建立等差序列)、rep() (重複)、sort() (排序)、class() (檢查物件類型)、subset() (求子集)、unique() (去重) 字串處理 (String Manipulation) 處理和轉換文字/字元向量 paste() / paste0() (連接字串)、nchar() (計算字元數)、substr() (取出子字串)、toupper() (轉大寫)、tolower() (轉小寫)、strsplit() (拆分字串) 陣列/矩陣操作 (Matrix/Array) 處理多維資料結構 t() (矩陣轉置)、cbind() (按列合併)、rbind() (按行合併)、dim() (取得維度)、%*% (矩陣乘法)、apply() (對陣列應用函數) 機率與分配 (Probability/Distribution) 處理統計機率分配 rnorm() (常態分布亂數)、dnorm() (常態機率密度)、pnorm() (常態累積機率)、dbinom() (二項式機率密度)、sample() (隨機抽樣) 輸入/輸出 (I/O) 讀取或寫入檔案資料 read.csv() (讀取 CSV)、write.csv() (寫入 CSV)、read.table() (讀取表格)、saveRDS() (儲存 R 物件) 在 R 語言中，每個函數的使用方式都是 函數名稱(參數1, 參數2, ...) 的形式。其中，括號內的參數 (argument) 用來控制函數執行的方式或指定輸入的資料。 例如，處理有缺失值 (NA) 的資料時，可以使用 mean() 函數的 na.rm = TRUE 參數來忽略這些缺失值： scores &lt;- c(85, 92, 78, 90, NA) # 包含一個缺失值 NA # 1. 直接計算：會回傳 NA mean(scores) # 2. 使用參數調整：移除缺失值後計算平均 mean(scores, na.rm = TRUE) 7.2 實用套件之函數 R 生態系提供大量功能強大的套件，能大幅提升資料處理、資料視覺化、 文字處理、日期處理、統計模型與機器學習等分析效率。 下表整理 11 個最常用、最知名的 R 套件 套件名稱 主要用途分類 簡短介紹 tidyverse 資料處理 / 視覺化 / 整潔資料 包含 dplyr、tidyr、ggplot2 等，是 R 的核心分析工具。 dplyr 資料處理（filter / select / mutate） 快速且直覺的資料操作語法。 ggplot2 資料視覺化 高彈性統計繪圖，建立高品質圖表。 tidyr 資料整形（Wide ↔︎ Long） 處理資料格式整理，如 pivot_longer() / pivot_wider()。 forcats 類別資料處理（factor） 最好用的 factor 操作工具，如排序、重新編碼。 data.table 高速資料處理 超大資料量下的高效運算利器。 lubridate 日期與時間處理 提供簡單直覺的日期運算工具。 stringr 字串處理 統一介面的字串操作。 shiny 互動式儀表板 用 R 建立網頁應用程式。 caret 機器學習 整合多種 ML 模型的統一介面。 reticulate 與 Python 互動 可呼叫 Python、匯入 Python 模組、執行 Python 物件。 7.3 自訂函數 在 R 語言中，自定義函數（Custom Functions） 是用戶可以根據自己的需求編寫並使用的函數。這些函數可以執行任何你想要的任務，從簡單的計算到複雜的數據處理。以下是一個簡單的例子，說明如何創建和使用自定義函數。 自定義函數的基本結構 自定義函數的一般形式如下： function_name &lt;- function(arguments) { # 函數主體 # 這裡是函數要執行的代碼 return(value) } 範例1: 簡單加法函數 add_numbers &lt;- function(a, b) { sum &lt;- a + b return(sum) } #使用這個函數 result &lt;- add_numbers(3, 5) print(result) # 輸出：8 ## [1] 8 範例2: 計算圓的面積 calculate_area &lt;- function(radius) { area &lt;- pi * radius^2 return(area) } #使用這個函數 circle_area &lt;- calculate_area(4) print(circle_area) # 輸出：50.26548 ## [1] 50.26548 範例3: 處理數據框的函數 column_means &lt;- function(dataframe) { means &lt;- sapply(dataframe, mean, na.rm = TRUE) return(means) } # 創建示例數據框 data &lt;- data.frame( x = c(1, 2, 3, 4, 5), y = c(6, 7, 8, 9, 10), z = c(11, 12, 13, 14, 15) ) # 計算每列的平均值 means &lt;- column_means(data) print(means) # 輸出： x y z ## x y z ## 3 8 13 # 3 8 13 7.4 do.call 及call 7.4.1 1. do.call 基本用途 簡單的講，do.call 的功能就是執行一個函數，而這個函數的參數呢，放在一個list裡面, 是list的每個子元素，見下列範例: do.call的第一個參數(what)預備執行的函數名稱,第二個參數(args)放list格式包起來的資料及相關函數設定，如下列範例: vec1 &lt;- c(4,9,NA,8,12,74,36,NA,55) do.call(mean, list(vec1)) ##輸出NA，因為無設定第二個參數值 ## [1] NA do.call(mean, list(vec1,na.rm = TRUE)) ##排除遺失值後，計算平均值 ## [1] 28.28571 7.4.2 2. do.call 常運用於data.frame的子元素 dt &lt;- data.frame(&#39;letter&#39; = letters[1:10], &#39;number&#39; = 1:10, &#39;value&#39; = c(&#39;+&#39;,&#39;-&#39;)) dt[[1]] ## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot; &quot;f&quot; &quot;g&quot; &quot;h&quot; &quot;i&quot; &quot;j&quot; dt[[2]] ## [1] 1 2 3 4 5 6 7 8 9 10 dt[[3]] ## [1] &quot;+&quot; &quot;-&quot; &quot;+&quot; &quot;-&quot; &quot;+&quot; &quot;-&quot; &quot;+&quot; &quot;-&quot; &quot;+&quot; &quot;-&quot; do.call(paste0,dt) ## [1] &quot;a1+&quot; &quot;b2-&quot; &quot;c3+&quot; &quot;d4-&quot; &quot;e5+&quot; &quot;f6-&quot; &quot;g7+&quot; &quot;h8-&quot; &quot;i9+&quot; &quot;j10-&quot; 7.4.3 3. do.call 亦可運用於list 資料格式 一心營業額 = list(&quot;北區&quot;=data.frame(&quot;月份&quot;= c(7,8,9,10) ,&quot;銷售額&quot;=c(10000,27000,68500,34000)), &quot;中區&quot;=data.frame(&quot;月份&quot;= c(7,8,9,10) ,&quot;銷售額&quot;=c(9000,10400,59400,48000)), &quot;南區&quot;=data.frame(&quot;月份&quot;= c(7,8,9,10) ,&quot;銷售額&quot;=c(8000,96000,70400,63500))) do.call(rbind,一心營業額) ## 月份 銷售額 ## 北區.1 7 10000 ## 北區.2 8 27000 ## 北區.3 9 68500 ## 北區.4 10 34000 ## 中區.1 7 9000 ## 中區.2 8 10400 ## 中區.3 9 59400 ## 中區.4 10 48000 ## 南區.1 7 8000 ## 南區.2 8 96000 ## 南區.3 9 70400 ## 南區.4 10 63500 7.4.4 call 與 do.call的差異 call 和 do.call很像，兩者主要差異: do.call() 執行某個已知現存的函數，例如內建函數sum()、mean()等，需將參數以列表的形式傳遞給函數後，才能正常運作。 #自創一個能計算BMI的函數 BMI &lt;- function(ht, wt) { x &lt;- wt / (ht / 100)^2 return(x) } # 建立一個有身高及體重資料集 DT &lt;- data.frame(&quot;ht&quot; = c(155, 168, 159), &quot;wt&quot; = c(80, 60, 48)) # 使用 do.call 將列表作為參數傳遞給 BMI 函數 result &lt;- do.call(BMI, list(ht = DT$ht, wt = DT$wt)) # 印出結果 print(result) ## [1] 33.29865 21.25850 18.98659 call() 以動態的方式生成函數呼叫，再用eval函數執行呼叫 #自創一個能計算BMI的函數 BMI &lt;- function(ht, wt) { x &lt;- wt / (ht / 100)^2 return(x) } # 建立一個有身高及體重資料集 DT &lt;- data.frame(&quot;ht&quot; = c(155, 168, 159), &quot;wt&quot; = c(80, 60, 48)) # 使用call函數動態生成函數呼叫 my_call &lt;- call(&quot;BMI&quot;, ht = DT$ht, wt = DT$wt) # 以eval函數執行生成的函數呼叫 result &lt;- eval(my_call) # 印出結果 print(result) ## [1] 33.29865 21.25850 18.98659 由上面兩段程式碼可以看出來，call函數還需要搭配eval函數執行後續的呼叫，所以實務上，do.call往往更常被使用，而另一個快速調用函數的方法則是apply家族 7.4.5 1.線上資源 R do.call &amp; call 函数教程 R語言中eval和do.call的用法 R語言do.call 函數用法詳解 "],["基礎繪圖.html", "Chapter 8 基礎繪圖 8.1 基礎繪圖的優勢 8.2 基本繪圖函數 plot() 8.3 其他常見統計圖形 8.4 多圖佈局 8.5 圖形註解與文字", " Chapter 8 基礎繪圖 R語言擁有強大而靈活的圖形系統，能夠建立高品質的統計圖形。本章將介紹R的基礎繪圖系統（Base Plotting System），這是R內建的繪圖功能，無需安裝額外套件即可使用。 8.1 基礎繪圖的優勢 內建功能：無需安裝額外套件 簡單易學：語法直觀 高度可自訂：幾乎可以控制圖形的每個細節 穩定可靠：與R版本完全相容 8.2 基本繪圖函數 plot() 8.2.1 plot()函數介紹 plot()是R中最常用的繪圖函數，它能根據輸入資料的類型自動選擇適當的圖形類型。 以下是plot()參數簡易說明: # R 基本繪圖函數 plot() 參數說明 plot( x, y = NULL, # x 與 y 座標資料 type = &quot;p&quot;, # 繪圖類型 xlim = NULL, # x 軸範圍 ylim = NULL, # y 軸範圍 log = &quot;&quot;, # 對數軸：&quot;x&quot;、&quot;y&quot; 或 &quot;xy&quot; main = NULL, # 主標題 sub = NULL, # 副標題 xlab = NULL, # x 軸標籤 ylab = NULL, # y 軸標籤 ann = par(&quot;ann&quot;), # 是否顯示默認註解（標題和軸標籤） axes = TRUE, # 是否繪製 x、y 坐標軸 frame.plot = axes, # 是否繪製圖框 panel.first = NULL, # 主圖前先畫的內容（背景格線等） panel.last = NULL, # 主圖後、軸與標題前畫的內容 asp = NA, # 圖形縱橫比（y/x 比例） xgap.axis = NA, # x 軸刻度與資料之間的間隙 ygap.axis = NA, # y 軸刻度與資料之間的間隙 col, # 點和線的顏色 bg, # 點符號的背景填充色（僅對某些pch有效） pch, # 點符號形狀（0-25為預定義符號） cex, # 點符號和文字縮放倍數 lwd # 線寬 lty, # 線條類型（1實線,2虛線等） cex.main, # 主標題縮放倍數 col.lab, # 軸標籤顏色 font.sub, # 副標題字體 ...) # 其他圖形參數 範例: 自動選擇適當的圖形類型 # 圖形佈局 par(mfrow = c(1, 2)) # 設定1行2列的圖形佈局 # 基本散點圖 x &lt;- 1:10 y &lt;- x^2 plot(x, y, main = &quot;基本散點圖&quot;, xlab = &quot;X軸&quot;, ylab = &quot;Y軸&quot;) # 使用內建資料集 plot(cars$speed, #X軸資料 cars$dist, #Y軸資料 main = &quot;汽車速度與煞車距離&quot;, #圖片標題 xlab = &quot;速度 (mph)&quot;, #X軸標題 ylab = &quot;距離 (英尺)&quot;) #Y軸標題 8.2.2 全域參數設定 par() plot() 可設定各別圖片的參數，但若想多個圖片有統一的樣式，可使用par()函數用於設定圖形的全域參數 # 設定圖形參數 par( mfrow = c(1, 2), # 設定布局 bg = &quot;bisque1&quot;, # 背景色 col = &quot;darkblue&quot;, # 預設顏色 col.axis = &quot;black&quot;, # 座標軸顏色 col.lab = &quot;darkred&quot;, # 標籤顏色 col.main = &quot;purple&quot;, # 標題顏色 font.axis = 2, # 座標軸字體 (2=粗體) font.lab = 3, # 標籤字體 (3=斜體) font.main = 4, # 標題字體 (4=粗斜體) las = 1, # 標籤方向 (1=水平) pch = 16, # 點形狀 cex = 1.2, # 符號大小 cex.axis = 0.9, # 座標軸文字大小 cex.lab = 1.1, # 標籤文字大小 cex.main = 1.3 # 標題文字大小 ) # 繪製圖形 x &lt;- 1:10 y &lt;- x^2 plot(x, y, main = &quot;基本散點圖&quot;, xlab = &quot;X軸&quot;, ylab = &quot;Y軸&quot;) # 使用內建資料集 plot(cars$speed, #X軸資料 cars$dist, #Y軸資料 main = &quot;汽車速度與煞車距離&quot;, #圖片標題 xlab = &quot;速度 (mph)&quot;, #X軸標題 ylab = &quot;距離 (英尺)&quot;) #Y軸標題 8.2.3 圖形類型設定 plot雖然可以自動選擇適當的圖形類型，但也可透過type參數可以指定不同的圖形類型： # 建立範例資料 time &lt;- 1:20 values &lt;- sin(time/3) + rnorm(20, 0, 0.2) # 不同的圖形類型 par(mfrow = c(2, 3)) # 設定2行3列的圖形佈局 plot(time, values, type = &quot;p&quot;, main = &quot;點圖 (type=&#39;p&#39;)&quot;) plot(time, values, type = &quot;l&quot;, main = &quot;線圖 (type=&#39;l&#39;)&quot;) plot(time, values, type = &quot;b&quot;, main = &quot;點線圖 (type=&#39;b&#39;)&quot;) plot(time, values, type = &quot;o&quot;, main = &quot;重疊點線圖 (type=&#39;o&#39;)&quot;) plot(time, values, type = &quot;h&quot;, main = &quot;垂直線圖 (type=&#39;h&#39;)&quot;) plot(time, values, type = &quot;s&quot;, main = &quot;階梯圖 (type=&#39;s&#39;)&quot;) par(mfrow = c(1, 1)) # 恢復單圖佈局 8.2.4 顏色設定 plot()中有多種方式指定顏色，可使用col參數 來呈現顏色： # 顏色示範 par(mfrow = c(2, 2)) # 1. 使用顏色名稱 plot(1:5, rep(1,5), pch=16, cex=3, col=c(&quot;red&quot;,&quot;blue&quot;,&quot;green&quot;,&quot;yellow&quot;,&quot;purple&quot;), main = &quot;顏色名稱&quot;, xlab=&quot;&quot;, ylab=&quot;&quot;) # 2. 使用RGB值 plot(1:5, rep(1,5), pch=16, cex=3, col=rgb(red=1:5/5, green=0, blue=0), main = &quot;RGB顏色&quot;, xlab=&quot;&quot;, ylab=&quot;&quot;) # 3. 使用十六進位值 plot(1:5, rep(1,5), pch=16, cex=3, col=c(&quot;#FF0000&quot;, &quot;#00FF00&quot;, &quot;#0000FF&quot;, &quot;#FFFF00&quot;, &quot;#FF00FF&quot;), main = &quot;十六進位顏色&quot;, xlab=&quot;&quot;, ylab=&quot;&quot;) # 4. 使用調色盤 palette(rainbow(5)) plot(1:5, rep(1,5), pch=16, cex=3, col=1:5, main = &quot;調色盤顏色&quot;, xlab=&quot;&quot;, ylab=&quot;&quot;) par(mfrow = c(1, 1)) palette(&quot;default&quot;) # 恢復預設調色盤 8.2.5 點形狀和線型 線型參數 lty = 線條形狀 （1～20） lwd = 線條尺寸 控制點參數 pch= 控制點形狀（1～25） cex= 控制大小 點與線之各類樣式 # 設定圖形佈局 par(mfrow = c(2, 2), mar = c(4, 4, 3, 1)) # 1. 基本折線圖 x &lt;- 1:10 y1 &lt;- c(2, 4, 6, 8, 7, 5, 6, 8, 10, 12) plot(x, y1, type = &quot;o&quot;, col = &quot;blue&quot;, lwd = 2, pch = 16, main = &quot;基本折線圖&quot;, xlab = &quot;X軸&quot;, ylab = &quot;Y軸&quot;) grid() # 添加網格線 # 2. 不同線型的折線圖 y2 &lt;- c(1, 3, 5, 4, 6, 8, 9, 7, 8, 10) plot(x, y1, type = &quot;l&quot;, lty = 1, col = &quot;red&quot;, lwd = 2, main = &quot;不同線型比較&quot;, xlab = &quot;X軸&quot;, ylab = &quot;Y軸&quot;) lines(x, y2, type = &quot;l&quot;, lty = 2, col = &quot;blue&quot;, lwd = 2) legend(&quot;topleft&quot;, legend = c(&quot;實線&quot;, &quot;虛線&quot;), col = c(&quot;red&quot;, &quot;blue&quot;), lty = 1:2, lwd = 2) # 3. 簡單散點圖 set.seed(123) x_scatter &lt;- 1:20 y_scatter &lt;- 2 * x_scatter + rnorm(20, 0, 3) plot(x_scatter, y_scatter, pch = 16, col = &quot;darkgreen&quot;, cex = 1.2, main = &quot;簡單散點圖&quot;, xlab = &quot;X軸&quot;, ylab = &quot;Y軸&quot;) # 4. 多組數據散點圖 group1_x &lt;- rnorm(15, 5, 1) group1_y &lt;- rnorm(15, 5, 1) group2_x &lt;- rnorm(15, 8, 1) group2_y &lt;- rnorm(15, 8, 1) plot(group1_x, group1_y, pch = 16, col = &quot;red&quot;, cex = 1.2, main = &quot;兩組數據散點圖&quot;, xlab = &quot;X軸&quot;, ylab = &quot;Y軸&quot;, xlim = c(2, 11), ylim = c(2, 11)) points(group2_x, group2_y, pch = 17, col = &quot;blue&quot;, cex = 1.2) legend(&quot;topleft&quot;, legend = c(&quot;組別A&quot;, &quot;組別B&quot;), col = c(&quot;red&quot;, &quot;blue&quot;), pch = c(16, 17)) # 恢復單圖佈局 par(mfrow = c(1, 1)) 8.3 其他常見統計圖形 8.3.1 直方圖hist() # 直方圖 set.seed(123) data &lt;- rnorm(1000, mean=50, sd=10) par(mfrow = c(2, 2)) hist(data, main = &quot;預設直方圖&quot;) hist(data, breaks = 20, main = &quot;20個分組&quot;, col = &quot;lightblue&quot;) hist(data, probability = TRUE, main = &quot;機率密度&quot;, col = &quot;lightgreen&quot;) lines(density(data), col = &quot;red&quot;, lwd = 2) # 添加密度曲線 hist(data, main = &quot;自訂顏色&quot;, col = c(&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;yellow&quot;, &quot;purple&quot;)) par(mfrow = c(1, 1)) 8.3.2 盒鬚圖 boxplot() # 盒鬚圖 par(mfrow = c(2, 2)) # 基本盒鬚圖 boxplot(mtcars$mpg, main = &quot;單變量盒鬚圖&quot;, ylab = &quot;MPG&quot;) # 分組盒鬚圖 boxplot(mpg ~ cyl, data = mtcars, main = &quot;按氣缸數分組的MPG&quot;, xlab = &quot;氣缸數&quot;, ylab = &quot;MPG&quot;) # 水平盒鬚圖 boxplot(mtcars$mpg, horizontal = TRUE, main = &quot;水平盒鬚圖&quot;) # 帶顏色的盒鬚圖 boxplot(mpg ~ gear, data = mtcars, col = rainbow(3), main = &quot;帶顏色的盒鬚圖&quot;) par(mfrow = c(1, 1)) 8.3.3 長條圖 barplot() # 長條圖 par(mfrow = c(2, 2)) # 簡單長條圖 counts &lt;- table(mtcars$gear) barplot(counts, main = &quot;簡單長條圖&quot;, xlab = &quot;檔位數&quot;) # 水平長條圖 barplot(counts, horiz = TRUE, main = &quot;水平長條圖&quot;) # 分組長條圖 counts2 &lt;- table(mtcars$vs, mtcars$gear) barplot(counts2, main = &quot;分組長條圖&quot;, xlab = &quot;檔位數&quot;, col = c(&quot;darkblue&quot;,&quot;red&quot;), legend = rownames(counts2), beside = TRUE) # 堆疊長條圖 barplot(counts2, main = &quot;堆疊長條圖&quot;, xlab = &quot;檔位數&quot;, col = c(&quot;darkblue&quot;,&quot;red&quot;), legend = rownames(counts2), beside = FALSE) par(mfrow = c(1, 1)) 8.3.4 圓餅圖 pie() # 圓餅圖 par(mfrow = c(2, 2)) # 基本圓餅圖 slices &lt;- c(20, 30, 25, 25) lbls &lt;- c(&quot;A部門&quot;, &quot;B部門&quot;, &quot;C部門&quot;, &quot;D部門&quot;) pie(slices, labels = lbls, main = &quot;基本圓餅圖&quot;) # 帶百分比的圓餅圖 pct &lt;- round(slices/sum(slices)*100) lbls2 &lt;- paste(lbls, &quot; &quot;, pct, &quot;%&quot;, sep=&quot;&quot;) pie(slices, labels = lbls2, main = &quot;帶百分比圓餅圖&quot;) # 3D圓餅圖（需要plotrix套件） # install.packages(&quot;plotrix&quot;) library(plotrix) pie3D(slices, labels = lbls, explode = 0.1, main = &quot;3D圓餅圖&quot;) # 自訂顏色圓餅圖 colors &lt;- c(&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;yellow&quot;) pie(slices, labels = lbls, col = colors, main = &quot;彩色圓餅圖&quot;) par(mfrow = c(1, 1)) 8.4 多圖佈局 8.4.1 基礎多圖佈局 # 基礎多圖佈局 par(mfrow = c(2, 2)) # 2行2列 plot(1:10, main = &quot;圖1&quot;) plot(rnorm(20), type = &quot;l&quot;, main = &quot;圖2&quot;) hist(rnorm(100), main = &quot;圖3&quot;) boxplot(1:10, main = &quot;圖4&quot;) par(mfrow = c(1, 1)) # 恢復單圖 8.4.2 自訂佈局 # 自訂佈局 layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE)) # 佈局解釋： # [1,1] 表示第一個圖形佔據第一行的兩個位置 # [2,3] 表示第二行分為兩個位置，第二個和第三個圖形 plot(1:10, main = &quot;大圖 (佔據第一行)&quot;) plot(rnorm(20), main = &quot;小圖1&quot;) plot(rnorm(20), main = &quot;小圖2&quot;) layout(1) # 恢復預設佈局 8.5 圖形註解與文字 8.5.1 添加文字和標題 # 圖形註解 plot(1:10, 1:10, type = &quot;n&quot;, main = &quot;圖形註示例&quot;, xlab = &quot;X&quot;, ylab = &quot;Y&quot;) # 添加點 points(5, 5, pch = 16, cex = 2, col = &quot;red&quot;) # 添加文字 text(5, 5, &quot;中心點&quot;, pos = 1, col = &quot;red&quot;) # pos=1 表示在點下方 text(2, 8, &quot;左上文字&quot;, adj = 0, col = &quot;blue&quot;) text(8, 2, &quot;右下文字&quot;, adj = 1, col = &quot;darkgreen&quot;) # 添加數學公式 text(5, 9, expression(bar(x) == sum(frac(x[i], n), i==1, n)), cex = 1.2) # 添加圖例 legend(&quot;bottomright&quot;, legend = c(&quot;類別 A&quot;, &quot;類別 B&quot;), pch = c(16, 1), col = c(&quot;red&quot;, &quot;blue&quot;), title = &quot;圖例&quot;) # 添加網格 grid() 8.5.2 添加額外線條和形狀 # 線條和形狀 plot(1:10, type = &quot;n&quot;, xlim = c(0, 11), ylim = c(0, 11), main = &quot;線條和形狀示例&quot;, xlab = &quot;X&quot;, ylab = &quot;Y&quot;) # 添加水平線和垂直線 abline(h = 5, col = &quot;red&quot;, lty = 2, lwd = 2) # 水平線 abline(v = 5, col = &quot;blue&quot;, lty = 2, lwd = 2) # 垂直線 abline(a = 0, b = 1, col = &quot;green&quot;, lwd = 2) # 斜率為1的直線 # 添加線段 segments(x0 = 2, y0 = 2, x1 = 8, y1 = 8, col = &quot;purple&quot;, lwd = 3) # 添加箭頭 arrows(x0 = 1, y0 = 9, x1 = 3, y1 = 7, col = &quot;orange&quot;, lwd = 2, length = 0.1) # 添加多邊形 polygon(x = c(7, 9, 8), y = c(2, 2, 4), col = &quot;pink&quot;, border = &quot;red&quot;) # 添加矩形 rect(xleft = 1, ybottom = 8, xright = 3, ytop = 10, col = &quot;lightblue&quot;, border = &quot;darkblue&quot;) "],["文字與時間處理.html", "Chapter 9 文字與時間處理 9.1 內建文字函數(base) 9.2 stringr套件 9.3 正則表達式", " Chapter 9 文字與時間處理 在R中，有需多內建的文字處理函數，可以對文字進行搜尋、取代、切割或擷取，除此之外，R在文字處理亦有一個套件 library(stringr)，可以彌補內建函數部分不足之處。 9.1 內建文字函數(base) 1. 大小寫切換 # 全部轉小寫之函數 tolower(&quot;HAPPLY DAY&quot;) ## [1] &quot;happly day&quot; # 全部轉大寫之函數 toupper(&quot;happly day&quot;) ## [1] &quot;HAPPLY DAY&quot; 2. 文字搜尋 # 找出符合條件的向量內位置 grep(pattern, x, ignore.case = FALSE, perl = FALSE, value = FALSE, fixed = FALSE, useBytes = FALSE, invert = FALSE) # 找出符合條件之邏輯判斷(TRUE FALSE) grepl(pattern, x, ignore.case = FALSE, perl = FALSE, fixed = FALSE, useBytes = FALSE) 3. 文字取代 # 只替换第一次匹配的字串 sub(pattern, replacement, x, ignore.case = FALSE, perl = FALSE, fixed = FALSE, useBytes = FALSE) # 替换所有匹配的字串 gsub(pattern, replacement, x, ignore.case = FALSE, perl = FALSE, fixed = FALSE, useBytes = FALSE) 4. 使用位址擷取 # 根據起始位址和結束位址，擷取出特定文字 substr(x, start, stop) # 根據起始位址和結束位址，擷取出特定文字，但結束位置可以向量化 substring(x, first, last) 5. 符合條件下之位址搜尋 # 找出符合條件的字串向量的起始位置 regexpr(pattern, text, ignore.case = FALSE, perl = FALSE, fixed = FALSE, useBytes = FALSE) # 找出符合條件的字串向量的起始位置,各自列表化 gregexpr(pattern, text, ignore.case = FALSE, perl = FALSE, fixed = FALSE, useBytes = FALSE) 與gregexpr類似的函數，還有regexec、gregexec，差異不大，只是輸出方式不同，筆者認為以後續處理方便性而言，gregexpr是比較值得學習的函數 9.2 stringr套件 library(stringr) # 首字母轉換成大寫字母 str_to_title(&quot;jack&quot;) #1.字串分割(可割多句) #輸出格式list str_split(string, pattern, n = Inf, simplify = FALSE) #2.字串分割(只割一句) str_split_1(string, pattern) #3.字串分割(指定割出多少詞) #輸出格式matrix str_split_fixed(string, pattern, n) #4.字串分割(指定割出後，輸出第i個字串) #輸出格式matrix str_split_i(string, pattern, i) fool= c(&quot;蘋果and橘子and香蕉and西瓜&quot;,&quot;豬肉and牛肉and雞肉&quot;) str_split_i(fool, &quot;and&quot;,3) #5.比對 (想找包含 西瓜 在內的字串) #類似 grepl str_detect(fool, pattern = &quot;西瓜&quot; ) grepl(&quot;西瓜&quot;, fool) 9.3 正則表達式 正則表達式（Regular Expressions）是一種用來匹配字串模式的工具，正規表達式有 . ^ $ * + ? \\ | []() {} 保留字元。正規表示式從左到右進行計算，並遵循優先順序，這與算術表達式非常類似。相同優先權的從左到右進行運算，不同優先權的運算先高後低，下表為相同優先權等級說明 運算符 說明 \\ 轉義符 ( )、[ ] 圓括號和方括號 *、+、?、{n}、{n,}、{n,m} 量詞限定符 ^、$ 、\\任何元字符 定位點和序位 | 替換、或 常見正則表達式，優先級別由高到低順序如下 優先順序 種類 說明 1 轉義符 \\是用於轉義其他特殊字元的轉義符號。它具有最高的優先權。 範例：\\d、\\. 等，其中 \\d 符合數字，\\. 符合點號。 2 括號 圓括號 () 用於建立子表達式，具有高於其他運算子的優先權。 範例：(abc)+ 符合 “abc” 一次或多次。 3 量詞 量詞指定前面的元素可以重複的次數。 範例：a*符合零個或多個 “a”。 4 字符類 使用方括號 [ ] 表示，用於匹配括號內的任意字元。 範例：[aeiou] 符合任何一個母音字母。 5 斷言 用於檢查字串中特定位置的條件的元素。 範例：^ 表示行的開頭，$ 表示行的結尾。 6 連接 沒有其他運算子的情況下表示字元之間的簡單連接。 範例：abc 匹配 “abc”。 7 管道 表示”或”，用於在多個模式之間選擇一個。 範例：cat|dog 符合 “cat” 或 “dog”。 常見正則表達式用法如下表，可分成五大類 分類 說明 匹配字元 .：匹配任意單個字元（除了換行符）。 \\\\d：匹配任意數字（相當於 [0-9]）。 \\\\D：匹配任意非數字字元。 \\\\w：匹配任意字母、數字或下劃線字元（相當於 [a-zA-Z0-9_]）。 \\\\W：匹配任意非字母、數字或下劃線字元。 \\\\s：匹配任意空白字元（空格、制表符、換行符等）。 \\\\S：匹配任意非空白字元。 匹配量詞 *：匹配前面的元素零次或多次。 +：匹配前面的元素一次或多次。 ?：匹配前面的元素零次或一次。 {n}：匹配前面的元素恰好 n 次。 {n,}：匹配前面的元素至少 n 次。 {n,m}：匹配前面的元素至少 n 次，但不超過 m 次。 錨點 ^：匹配字串的開頭。 $：匹配字串的結尾。 \\\\b：匹配一個單字邊界，指單詞間的空白位置(出現空字串(空白)開始或結束的位置)。 \\\\B：出現非字串開始或結束的位置，和\\\\b相反。 分組 (...)：將模式括起來，作為一個組。 |：表示“或”，例如 a|b 匹配 a 或 b 轉義字符 \\：正規表達式中用\\進行「轉義」，但R本身也用來\\來跳脫字符，所以使用正則表達式搜尋轉義字符時，需要兩個斜線\\\\。 \\\\n：換行符，將游標移到下一行的開頭 \\\\t：製表符，插入一個水平製表符，用於對齊文本(Tab鍵) \\\\r：回車符，將游標移到行首，不移到下一行 \\\\b：退格符 (backspace)，將游標移到前一個字符的位置，但不刪除該字符 \\\\f：換頁符。 \\\\\\：單一反斜線。 \\\\\"：雙引號。 \\\\'：單引號。 stringr套件總共提供30個字串處理函數，其中大部分皆可支援正規表示式應用，包內所有以str_開頭函數，後面單字用來說明該函數意義。 stringr套件中的函數在使用正則表達式時(例如str_detect)，與基本文字搜尋grep函數不同，可以匹配許多萬國字元，搭配[]使用，能夠比對多個特定字元，屬於字元集合，例如比對任意大寫字母可以用[A-Z]，或者[:upper:] ，下列整理 字元集合 說明(搭配萬國字元) 一般用法 [:digit:] 比對任何數字 [0-9] [:lower:] 比對任意小寫字母 [a-z] [:upper:] 比對任意大寫字母 [A-Z] [:alpha:] 比對任意字母 [a-zA-Z] [:alnum:] 比對任意字母和數字 [a-zA-Z0-9] [:blank:] 比對空格和定位字元 [ [:space:] 比對任意空白字元，包含空格、定位字元、換行字元（\\n）、換頁字元（\\f）、Enter字元（\\r) [ \\t\\n\\r\\f] [:punct:] 比對任意標點符號 - [:print:] 比對任意可印刷字元，等同任意字母和數字、標點符號、空白字元 [:cntrl:] 比對任意不可印刷字元，也稱為控制字元 "],["認識apply家族.html", "Chapter 10 認識apply家族 10.1 apply系列家族應用情境 10.2 apply用法 10.3 sapply/lapply用法 10.4 mapply用法", " Chapter 10 認識apply家族 apply家族主要功能是將所設定的函數應用到指定物件的每一個欄或列，基本使用格式如下: apply(x,MARGIN,FUN,...) x: 可以是矩陣(Matrix)、陣列(Array)、數據框(data.frame) MARGIN:1代表每一列,2代表每一欄 FUN: 預計使用的函數 . . . : FUN函數所需的額外參數，例如na.rm=TRUE 10.1 apply系列家族應用情境 函數名稱 特色 x的類型(輸入的資料結構) y的類型(輸出的資料結構) apply 接受矩陣輸入 行或列皆可處理 1:行;2:欄 矩陣(Matrix)、陣列(Array)、數據框(data.frame) 向量(Vector), Named numeric sapply lapply 只能處理欄，接受向量輸入 向量(Vector)、串列(List)、數據框(data.frame) sapply:向量(Vector) lapply:串列(List) mapply 同時處理多個向量、串列的輸入 向量(Vector)、串列(List)， SIMPLIFY = TRUE: 輸出向量 SIMPLIFY = FALSE: 輸出串列 tapply 有2個X輸入，其中一個X為factor輸入 x1: 通常是向量(Vector) x2: 因子(factor)，或分類的文字向量或因子串列 向量(Vector) 10.2 apply用法 1.apply函數，輸入Matrix資料結構，輸出numeric向量 # 輸入Matrix資料結構，輸出numeric向量 DT &lt;- matrix(c(8, 9, 6, 5, 7, 2, 10, 6, 8), ncol=3) colnames(DT) &lt;- c(&quot;獅子&quot;,&quot;斑馬&quot;,&quot;熊貓&quot;) rownames(DT) &lt;- c(&quot;Day 1&quot;, &quot;Day 2&quot;, &quot;Day 3&quot;) print(DT) Vec &lt;- apply(DT, 2, max) class(Vec) apply函數輸出如下 ## 獅子 斑馬 熊貓 ## Day 1 8 5 10 ## Day 2 9 7 6 ## Day 3 6 2 8 ## 獅子 斑馬 熊貓 ## 9 7 10 ## [1] &quot;numeric&quot; 2.apply函數，輸入data.frame資料結構，輸出numeric向量 # 輸入data.frame資料結構，輸出numeric向量 DT &lt;- data.frame(&quot;獅子&quot;=c(8,9,2),&quot;斑馬&quot;=c(5,7,2),&quot;熊貓&quot;=c(10,6,8)) print(DT) (Vec &lt;- apply(DT, 2, max)) class(Vec) apply函數輸出如下 ## 獅子 斑馬 熊貓 ## 1 8 5 10 ## 2 9 7 6 ## 3 2 2 8 ## 獅子 斑馬 熊貓 ## 9 7 10 ## [1] &quot;numeric&quot; 10.3 sapply/lapply用法 lapply 和 sapply 是 R 語言中常用的函數，兩者都是用來將一個函數應用到列表或向量的每個元素上，但它們在結果的返回形式上有所不同。以下是它們的主要差異及範例： lapply()總是返回一個list，不管輸入的複雜程度如何。 sapply()則嘗試簡化輸出結果，盡可能將其化簡為向量或矩陣。 1.lapply處理向量，輸出list # 使用 lapply 計算每個元素的平方 x &lt;- 1:5 # 定義一個數組向量 result &lt;- lapply(x, function(num) num^2) # 使用 lapply 計算每個元素的平方 print(result) ## [[1]] ## [1] 1 ## ## [[2]] ## [1] 4 ## ## [[3]] ## [1] 9 ## ## [[4]] ## [1] 16 ## ## [[5]] ## [1] 25 2.lapply處理list，輸出list # 使用 lapply 計算每欄的總和 my_list &lt;- list(a = 1:5, b = 6:10, c = 11:15) result_lapply &lt;- lapply(my_list, sum) print(result_lapply) ## $a ## [1] 15 ## ## $b ## [1] 40 ## ## $c ## [1] 65 sapply處理向量，輸出向量 # 使用 sapply 計算每個元素的平方 x &lt;- 1:5 # 定義一個數組向量 result &lt;- sapply(x, function(num) num^2) # 使用 sapply 計算每個元素的平方 print(result) ## [1] 1 4 9 16 25 4.sapply處理list，輸出向量 # 使用 sapply 計算每欄的總和 my_list &lt;- list(a = 1:5, b = 6:10, c = 11:15) result_lapply &lt;- sapply(my_list, sum) print(result_lapply) ## a b c ## 15 40 65 10.4 mapply用法 mapply 專門用於同時處理多個向量或列表的函數。它的主要功能是對多個輸入進行逐元素的計算，類似於 sapply，但可以處理多個參數。 函數用法 mapply(FUN, ..., MoreArgs = NULL, SIMPLIFY = TRUE, USE.NAMES = TRUE) FUN: 要應用的函數。 …: 一個或多個向量或列表。 MoreArgs: 附加的參數，傳遞給 FUN。 SIMPLIFY: 是否簡化輸出結果，預設為 TRUE。 USE.NAMES: 是否使用輸入的名稱作為輸出名稱。 範例1: 計算兩個向量的總和 vector1 &lt;- c(10, 20, 30) vector2 &lt;- c(1, 2, 3) total &lt;- mapply(sum, vector1, vector2) print(total) ## [1] 11 22 33 範例2: 用身高、性別和年齡來計算尖峰呼氣流速理想值 (PEFR) # 設定隨機種子以便重現 set.seed(123) # 步驟1: 創建資料集 DT DT &lt;- data.frame(Gender = sample(c(0, 1), size = 30, replace = TRUE), # 性別變數 (0: 女性, 1: 男性), Height = sample(150:190, size = 30, replace = TRUE), # 身高變數 (cm), Age = sample(20:50, size = 30, replace = TRUE)) # 年齡變數 (20-50歲)) # 步驟2: 定義 PEFR 函數 PEFR &lt;- function(gender, height, age) { if (gender == 1) { # 男性 return(3.89 * height - 2.95 * age + 43.59) } else { # 女性 return(4.10 * height - 1.61 * age - 173.55) } } # 步驟3: 使用 mapply 計算 PEFR 預測值並新增到 DT DT$PEFR_Predicted &lt;- mapply(PEFR, DT$Gender, DT$Height, DT$Age) # 顯示更新後的資料集 head(DT) ## Gender Height Age PEFR_Predicted ## 1 0 158 25 434.00 ## 2 0 168 40 450.85 ## 3 0 185 34 530.21 ## 4 1 163 28 595.06 ## 5 0 166 34 452.31 ## 6 1 188 45 642.16 "],["dplyr及-tidyr運用.html", "Chapter 11 dplyr及 tidyr運用 11.1 簡介 11.2 dplyr核心函數 11.3 tidyr核心函數 11.4 常用技巧與綜合應用 11.5 延伸學習", " Chapter 11 dplyr及 tidyr運用 11.1 簡介 dplyr和tidyr是R語言中最重要的資料處理套件，它們提供了一套直觀且一致的函數來處理資料框。這兩個套件都是tidyverse生態系統的核心成員，可單獨安裝，或安裝tidyverse即可。 11.1.1 11.1.1 安裝與載入 # 安裝套件（如果尚未安裝） # install.packages(&quot;tidyverse&quot;) # 載入套件 library(dplyr) library(tidyr) 11.2 dplyr核心函數 11.2.1 filter() - 資料篩選 filter()用於根據條件篩選資料列。 # 使用內建資料集 data(&quot;mtcars&quot;) # 基本篩選 filter(mtcars, mpg &gt; 20) ## mpg cyl disp hp drat wt qsec vs am gear carb ## Mazda RX4 21.0 6 160.0 110 3.90 2.620 16.46 0 1 4 4 ## Mazda RX4 Wag 21.0 6 160.0 110 3.90 2.875 17.02 0 1 4 4 ## Datsun 710 22.8 4 108.0 93 3.85 2.320 18.61 1 1 4 1 ## Hornet 4 Drive 21.4 6 258.0 110 3.08 3.215 19.44 1 0 3 1 ## Merc 240D 24.4 4 146.7 62 3.69 3.190 20.00 1 0 4 2 ## Merc 230 22.8 4 140.8 95 3.92 3.150 22.90 1 0 4 2 ## Fiat 128 32.4 4 78.7 66 4.08 2.200 19.47 1 1 4 1 ## Honda Civic 30.4 4 75.7 52 4.93 1.615 18.52 1 1 4 2 ## Toyota Corolla 33.9 4 71.1 65 4.22 1.835 19.90 1 1 4 1 ## Toyota Corona 21.5 4 120.1 97 3.70 2.465 20.01 1 0 3 1 ## Fiat X1-9 27.3 4 79.0 66 4.08 1.935 18.90 1 1 4 1 ## Porsche 914-2 26.0 4 120.3 91 4.43 2.140 16.70 0 1 5 2 ## Lotus Europa 30.4 4 95.1 113 3.77 1.513 16.90 1 1 5 2 ## Volvo 142E 21.4 4 121.0 109 4.11 2.780 18.60 1 1 4 2 # 多重條件篩選 filter(mtcars, mpg &gt; 20, cyl == 4) ## mpg cyl disp hp drat wt qsec vs am gear carb ## Datsun 710 22.8 4 108.0 93 3.85 2.320 18.61 1 1 4 1 ## Merc 240D 24.4 4 146.7 62 3.69 3.190 20.00 1 0 4 2 ## Merc 230 22.8 4 140.8 95 3.92 3.150 22.90 1 0 4 2 ## Fiat 128 32.4 4 78.7 66 4.08 2.200 19.47 1 1 4 1 ## Honda Civic 30.4 4 75.7 52 4.93 1.615 18.52 1 1 4 2 ## Toyota Corolla 33.9 4 71.1 65 4.22 1.835 19.90 1 1 4 1 ## Toyota Corona 21.5 4 120.1 97 3.70 2.465 20.01 1 0 3 1 ## Fiat X1-9 27.3 4 79.0 66 4.08 1.935 18.90 1 1 4 1 ## Porsche 914-2 26.0 4 120.3 91 4.43 2.140 16.70 0 1 5 2 ## Lotus Europa 30.4 4 95.1 113 3.77 1.513 16.90 1 1 5 2 ## Volvo 142E 21.4 4 121.0 109 4.11 2.780 18.60 1 1 4 2 # 使用OR條件 filter(mtcars, mpg &gt; 20 | hp &gt; 150) ## mpg cyl disp hp drat wt qsec vs am gear carb ## Mazda RX4 21.0 6 160.0 110 3.90 2.620 16.46 0 1 4 4 ## Mazda RX4 Wag 21.0 6 160.0 110 3.90 2.875 17.02 0 1 4 4 ## Datsun 710 22.8 4 108.0 93 3.85 2.320 18.61 1 1 4 1 ## Hornet 4 Drive 21.4 6 258.0 110 3.08 3.215 19.44 1 0 3 1 ## Hornet Sportabout 18.7 8 360.0 175 3.15 3.440 17.02 0 0 3 2 ## Duster 360 14.3 8 360.0 245 3.21 3.570 15.84 0 0 3 4 ## Merc 240D 24.4 4 146.7 62 3.69 3.190 20.00 1 0 4 2 ## Merc 230 22.8 4 140.8 95 3.92 3.150 22.90 1 0 4 2 ## Merc 450SE 16.4 8 275.8 180 3.07 4.070 17.40 0 0 3 3 ## Merc 450SL 17.3 8 275.8 180 3.07 3.730 17.60 0 0 3 3 ## Merc 450SLC 15.2 8 275.8 180 3.07 3.780 18.00 0 0 3 3 ## Cadillac Fleetwood 10.4 8 472.0 205 2.93 5.250 17.98 0 0 3 4 ## Lincoln Continental 10.4 8 460.0 215 3.00 5.424 17.82 0 0 3 4 ## Chrysler Imperial 14.7 8 440.0 230 3.23 5.345 17.42 0 0 3 4 ## Fiat 128 32.4 4 78.7 66 4.08 2.200 19.47 1 1 4 1 ## Honda Civic 30.4 4 75.7 52 4.93 1.615 18.52 1 1 4 2 ## Toyota Corolla 33.9 4 71.1 65 4.22 1.835 19.90 1 1 4 1 ## Toyota Corona 21.5 4 120.1 97 3.70 2.465 20.01 1 0 3 1 ## Camaro Z28 13.3 8 350.0 245 3.73 3.840 15.41 0 0 3 4 ## Pontiac Firebird 19.2 8 400.0 175 3.08 3.845 17.05 0 0 3 2 ## Fiat X1-9 27.3 4 79.0 66 4.08 1.935 18.90 1 1 4 1 ## Porsche 914-2 26.0 4 120.3 91 4.43 2.140 16.70 0 1 5 2 ## Lotus Europa 30.4 4 95.1 113 3.77 1.513 16.90 1 1 5 2 ## Ford Pantera L 15.8 8 351.0 264 4.22 3.170 14.50 0 1 5 4 ## Ferrari Dino 19.7 6 145.0 175 3.62 2.770 15.50 0 1 5 6 ## Maserati Bora 15.0 8 301.0 335 3.54 3.570 14.60 0 1 5 8 ## Volvo 142E 21.4 4 121.0 109 4.11 2.780 18.60 1 1 4 2 # 配合%in%運算子 filter(mtcars, cyl %in% c(4, 6)) ## mpg cyl disp hp drat wt qsec vs am gear carb ## Mazda RX4 21.0 6 160.0 110 3.90 2.620 16.46 0 1 4 4 ## Mazda RX4 Wag 21.0 6 160.0 110 3.90 2.875 17.02 0 1 4 4 ## Datsun 710 22.8 4 108.0 93 3.85 2.320 18.61 1 1 4 1 ## Hornet 4 Drive 21.4 6 258.0 110 3.08 3.215 19.44 1 0 3 1 ## Valiant 18.1 6 225.0 105 2.76 3.460 20.22 1 0 3 1 ## Merc 240D 24.4 4 146.7 62 3.69 3.190 20.00 1 0 4 2 ## Merc 230 22.8 4 140.8 95 3.92 3.150 22.90 1 0 4 2 ## Merc 280 19.2 6 167.6 123 3.92 3.440 18.30 1 0 4 4 ## Merc 280C 17.8 6 167.6 123 3.92 3.440 18.90 1 0 4 4 ## Fiat 128 32.4 4 78.7 66 4.08 2.200 19.47 1 1 4 1 ## Honda Civic 30.4 4 75.7 52 4.93 1.615 18.52 1 1 4 2 ## Toyota Corolla 33.9 4 71.1 65 4.22 1.835 19.90 1 1 4 1 ## Toyota Corona 21.5 4 120.1 97 3.70 2.465 20.01 1 0 3 1 ## Fiat X1-9 27.3 4 79.0 66 4.08 1.935 18.90 1 1 4 1 ## Porsche 914-2 26.0 4 120.3 91 4.43 2.140 16.70 0 1 5 2 ## Lotus Europa 30.4 4 95.1 113 3.77 1.513 16.90 1 1 5 2 ## Ferrari Dino 19.7 6 145.0 175 3.62 2.770 15.50 0 1 5 6 ## Volvo 142E 21.4 4 121.0 109 4.11 2.780 18.60 1 1 4 2 11.2.2 select() - 選擇變數 select()用於選擇特定的資料欄。 # 選擇特定欄位 select(mtcars, mpg, cyl, hp) ## mpg cyl hp ## Mazda RX4 21.0 6 110 ## Mazda RX4 Wag 21.0 6 110 ## Datsun 710 22.8 4 93 ## Hornet 4 Drive 21.4 6 110 ## Hornet Sportabout 18.7 8 175 ## Valiant 18.1 6 105 ## Duster 360 14.3 8 245 ## Merc 240D 24.4 4 62 ## Merc 230 22.8 4 95 ## Merc 280 19.2 6 123 ## Merc 280C 17.8 6 123 ## Merc 450SE 16.4 8 180 ## Merc 450SL 17.3 8 180 ## Merc 450SLC 15.2 8 180 ## Cadillac Fleetwood 10.4 8 205 ## Lincoln Continental 10.4 8 215 ## Chrysler Imperial 14.7 8 230 ## Fiat 128 32.4 4 66 ## Honda Civic 30.4 4 52 ## Toyota Corolla 33.9 4 65 ## Toyota Corona 21.5 4 97 ## Dodge Challenger 15.5 8 150 ## AMC Javelin 15.2 8 150 ## Camaro Z28 13.3 8 245 ## Pontiac Firebird 19.2 8 175 ## Fiat X1-9 27.3 4 66 ## Porsche 914-2 26.0 4 91 ## Lotus Europa 30.4 4 113 ## Ford Pantera L 15.8 8 264 ## Ferrari Dino 19.7 6 175 ## Maserati Bora 15.0 8 335 ## Volvo 142E 21.4 4 109 # 選擇欄位範圍 select(mtcars, mpg:drat) ## mpg cyl disp hp drat ## Mazda RX4 21.0 6 160.0 110 3.90 ## Mazda RX4 Wag 21.0 6 160.0 110 3.90 ## Datsun 710 22.8 4 108.0 93 3.85 ## Hornet 4 Drive 21.4 6 258.0 110 3.08 ## Hornet Sportabout 18.7 8 360.0 175 3.15 ## Valiant 18.1 6 225.0 105 2.76 ## Duster 360 14.3 8 360.0 245 3.21 ## Merc 240D 24.4 4 146.7 62 3.69 ## Merc 230 22.8 4 140.8 95 3.92 ## Merc 280 19.2 6 167.6 123 3.92 ## Merc 280C 17.8 6 167.6 123 3.92 ## Merc 450SE 16.4 8 275.8 180 3.07 ## Merc 450SL 17.3 8 275.8 180 3.07 ## Merc 450SLC 15.2 8 275.8 180 3.07 ## Cadillac Fleetwood 10.4 8 472.0 205 2.93 ## Lincoln Continental 10.4 8 460.0 215 3.00 ## Chrysler Imperial 14.7 8 440.0 230 3.23 ## Fiat 128 32.4 4 78.7 66 4.08 ## Honda Civic 30.4 4 75.7 52 4.93 ## Toyota Corolla 33.9 4 71.1 65 4.22 ## Toyota Corona 21.5 4 120.1 97 3.70 ## Dodge Challenger 15.5 8 318.0 150 2.76 ## AMC Javelin 15.2 8 304.0 150 3.15 ## Camaro Z28 13.3 8 350.0 245 3.73 ## Pontiac Firebird 19.2 8 400.0 175 3.08 ## Fiat X1-9 27.3 4 79.0 66 4.08 ## Porsche 914-2 26.0 4 120.3 91 4.43 ## Lotus Europa 30.4 4 95.1 113 3.77 ## Ford Pantera L 15.8 8 351.0 264 4.22 ## Ferrari Dino 19.7 6 145.0 175 3.62 ## Maserati Bora 15.0 8 301.0 335 3.54 ## Volvo 142E 21.4 4 121.0 109 4.11 # 排除特定欄位 select(mtcars, -carb, -gear) ## mpg cyl disp hp drat wt qsec vs am ## Mazda RX4 21.0 6 160.0 110 3.90 2.620 16.46 0 1 ## Mazda RX4 Wag 21.0 6 160.0 110 3.90 2.875 17.02 0 1 ## Datsun 710 22.8 4 108.0 93 3.85 2.320 18.61 1 1 ## Hornet 4 Drive 21.4 6 258.0 110 3.08 3.215 19.44 1 0 ## Hornet Sportabout 18.7 8 360.0 175 3.15 3.440 17.02 0 0 ## Valiant 18.1 6 225.0 105 2.76 3.460 20.22 1 0 ## Duster 360 14.3 8 360.0 245 3.21 3.570 15.84 0 0 ## Merc 240D 24.4 4 146.7 62 3.69 3.190 20.00 1 0 ## Merc 230 22.8 4 140.8 95 3.92 3.150 22.90 1 0 ## Merc 280 19.2 6 167.6 123 3.92 3.440 18.30 1 0 ## Merc 280C 17.8 6 167.6 123 3.92 3.440 18.90 1 0 ## Merc 450SE 16.4 8 275.8 180 3.07 4.070 17.40 0 0 ## Merc 450SL 17.3 8 275.8 180 3.07 3.730 17.60 0 0 ## Merc 450SLC 15.2 8 275.8 180 3.07 3.780 18.00 0 0 ## Cadillac Fleetwood 10.4 8 472.0 205 2.93 5.250 17.98 0 0 ## Lincoln Continental 10.4 8 460.0 215 3.00 5.424 17.82 0 0 ## Chrysler Imperial 14.7 8 440.0 230 3.23 5.345 17.42 0 0 ## Fiat 128 32.4 4 78.7 66 4.08 2.200 19.47 1 1 ## Honda Civic 30.4 4 75.7 52 4.93 1.615 18.52 1 1 ## Toyota Corolla 33.9 4 71.1 65 4.22 1.835 19.90 1 1 ## Toyota Corona 21.5 4 120.1 97 3.70 2.465 20.01 1 0 ## Dodge Challenger 15.5 8 318.0 150 2.76 3.520 16.87 0 0 ## AMC Javelin 15.2 8 304.0 150 3.15 3.435 17.30 0 0 ## Camaro Z28 13.3 8 350.0 245 3.73 3.840 15.41 0 0 ## Pontiac Firebird 19.2 8 400.0 175 3.08 3.845 17.05 0 0 ## Fiat X1-9 27.3 4 79.0 66 4.08 1.935 18.90 1 1 ## Porsche 914-2 26.0 4 120.3 91 4.43 2.140 16.70 0 1 ## Lotus Europa 30.4 4 95.1 113 3.77 1.513 16.90 1 1 ## Ford Pantera L 15.8 8 351.0 264 4.22 3.170 14.50 0 1 ## Ferrari Dino 19.7 6 145.0 175 3.62 2.770 15.50 0 1 ## Maserati Bora 15.0 8 301.0 335 3.54 3.570 14.60 0 1 ## Volvo 142E 21.4 4 121.0 109 4.11 2.780 18.60 1 1 # 輔助函數 select(mtcars, starts_with(&quot;c&quot;)) # 開頭為c的欄位 ## cyl carb ## Mazda RX4 6 4 ## Mazda RX4 Wag 6 4 ## Datsun 710 4 1 ## Hornet 4 Drive 6 1 ## Hornet Sportabout 8 2 ## Valiant 6 1 ## Duster 360 8 4 ## Merc 240D 4 2 ## Merc 230 4 2 ## Merc 280 6 4 ## Merc 280C 6 4 ## Merc 450SE 8 3 ## Merc 450SL 8 3 ## Merc 450SLC 8 3 ## Cadillac Fleetwood 8 4 ## Lincoln Continental 8 4 ## Chrysler Imperial 8 4 ## Fiat 128 4 1 ## Honda Civic 4 2 ## Toyota Corolla 4 1 ## Toyota Corona 4 1 ## Dodge Challenger 8 2 ## AMC Javelin 8 2 ## Camaro Z28 8 4 ## Pontiac Firebird 8 2 ## Fiat X1-9 4 1 ## Porsche 914-2 4 2 ## Lotus Europa 4 2 ## Ford Pantera L 8 4 ## Ferrari Dino 6 6 ## Maserati Bora 8 8 ## Volvo 142E 4 2 select(mtcars, ends_with(&quot;p&quot;)) # 結尾為p的欄位 ## disp hp ## Mazda RX4 160.0 110 ## Mazda RX4 Wag 160.0 110 ## Datsun 710 108.0 93 ## Hornet 4 Drive 258.0 110 ## Hornet Sportabout 360.0 175 ## Valiant 225.0 105 ## Duster 360 360.0 245 ## Merc 240D 146.7 62 ## Merc 230 140.8 95 ## Merc 280 167.6 123 ## Merc 280C 167.6 123 ## Merc 450SE 275.8 180 ## Merc 450SL 275.8 180 ## Merc 450SLC 275.8 180 ## Cadillac Fleetwood 472.0 205 ## Lincoln Continental 460.0 215 ## Chrysler Imperial 440.0 230 ## Fiat 128 78.7 66 ## Honda Civic 75.7 52 ## Toyota Corolla 71.1 65 ## Toyota Corona 120.1 97 ## Dodge Challenger 318.0 150 ## AMC Javelin 304.0 150 ## Camaro Z28 350.0 245 ## Pontiac Firebird 400.0 175 ## Fiat X1-9 79.0 66 ## Porsche 914-2 120.3 91 ## Lotus Europa 95.1 113 ## Ford Pantera L 351.0 264 ## Ferrari Dino 145.0 175 ## Maserati Bora 301.0 335 ## Volvo 142E 121.0 109 select(mtcars, contains(&quot;a&quot;)) # 包含a的欄位 ## drat am gear carb ## Mazda RX4 3.90 1 4 4 ## Mazda RX4 Wag 3.90 1 4 4 ## Datsun 710 3.85 1 4 1 ## Hornet 4 Drive 3.08 0 3 1 ## Hornet Sportabout 3.15 0 3 2 ## Valiant 2.76 0 3 1 ## Duster 360 3.21 0 3 4 ## Merc 240D 3.69 0 4 2 ## Merc 230 3.92 0 4 2 ## Merc 280 3.92 0 4 4 ## Merc 280C 3.92 0 4 4 ## Merc 450SE 3.07 0 3 3 ## Merc 450SL 3.07 0 3 3 ## Merc 450SLC 3.07 0 3 3 ## Cadillac Fleetwood 2.93 0 3 4 ## Lincoln Continental 3.00 0 3 4 ## Chrysler Imperial 3.23 0 3 4 ## Fiat 128 4.08 1 4 1 ## Honda Civic 4.93 1 4 2 ## Toyota Corolla 4.22 1 4 1 ## Toyota Corona 3.70 0 3 1 ## Dodge Challenger 2.76 0 3 2 ## AMC Javelin 3.15 0 3 2 ## Camaro Z28 3.73 0 3 4 ## Pontiac Firebird 3.08 0 3 2 ## Fiat X1-9 4.08 1 4 1 ## Porsche 914-2 4.43 1 5 2 ## Lotus Europa 3.77 1 5 2 ## Ford Pantera L 4.22 1 5 4 ## Ferrari Dino 3.62 1 5 6 ## Maserati Bora 3.54 1 5 8 ## Volvo 142E 4.11 1 4 2 11.2.3 mutate() - 新增變數 mutate()用於建立新的資料欄。 # 建立新變數 mtcars_new &lt;- mutate(mtcars, km_per_l = mpg * 0.425, # 轉換為km/l power_weight = hp / wt # 馬力重量比 ) head(select(mtcars_new, mpg, km_per_l, hp, wt, power_weight)) ## mpg km_per_l hp wt power_weight ## Mazda RX4 21.0 8.9250 110 2.620 41.98473 ## Mazda RX4 Wag 21.0 8.9250 110 2.875 38.26087 ## Datsun 710 22.8 9.6900 93 2.320 40.08621 ## Hornet 4 Drive 21.4 9.0950 110 3.215 34.21462 ## Hornet Sportabout 18.7 7.9475 175 3.440 50.87209 ## Valiant 18.1 7.6925 105 3.460 30.34682 # 使用ifelse建立分類變數 mtcars_class &lt;- mutate(mtcars, efficiency = ifelse(mpg &gt; 20, &quot;高效&quot;, &quot;一般&quot;) ) table(mtcars_class$efficiency) ## ## 一般 高效 ## 18 14 11.2.4 arrange() - 資料排序 arrange()用於對資料進行排序。 # 升冪排序 arrange(mtcars, mpg) ## mpg cyl disp hp drat wt qsec vs am gear carb ## Cadillac Fleetwood 10.4 8 472.0 205 2.93 5.250 17.98 0 0 3 4 ## Lincoln Continental 10.4 8 460.0 215 3.00 5.424 17.82 0 0 3 4 ## Camaro Z28 13.3 8 350.0 245 3.73 3.840 15.41 0 0 3 4 ## Duster 360 14.3 8 360.0 245 3.21 3.570 15.84 0 0 3 4 ## Chrysler Imperial 14.7 8 440.0 230 3.23 5.345 17.42 0 0 3 4 ## Maserati Bora 15.0 8 301.0 335 3.54 3.570 14.60 0 1 5 8 ## Merc 450SLC 15.2 8 275.8 180 3.07 3.780 18.00 0 0 3 3 ## AMC Javelin 15.2 8 304.0 150 3.15 3.435 17.30 0 0 3 2 ## Dodge Challenger 15.5 8 318.0 150 2.76 3.520 16.87 0 0 3 2 ## Ford Pantera L 15.8 8 351.0 264 4.22 3.170 14.50 0 1 5 4 ## Merc 450SE 16.4 8 275.8 180 3.07 4.070 17.40 0 0 3 3 ## Merc 450SL 17.3 8 275.8 180 3.07 3.730 17.60 0 0 3 3 ## Merc 280C 17.8 6 167.6 123 3.92 3.440 18.90 1 0 4 4 ## Valiant 18.1 6 225.0 105 2.76 3.460 20.22 1 0 3 1 ## Hornet Sportabout 18.7 8 360.0 175 3.15 3.440 17.02 0 0 3 2 ## Merc 280 19.2 6 167.6 123 3.92 3.440 18.30 1 0 4 4 ## Pontiac Firebird 19.2 8 400.0 175 3.08 3.845 17.05 0 0 3 2 ## Ferrari Dino 19.7 6 145.0 175 3.62 2.770 15.50 0 1 5 6 ## Mazda RX4 21.0 6 160.0 110 3.90 2.620 16.46 0 1 4 4 ## Mazda RX4 Wag 21.0 6 160.0 110 3.90 2.875 17.02 0 1 4 4 ## Hornet 4 Drive 21.4 6 258.0 110 3.08 3.215 19.44 1 0 3 1 ## Volvo 142E 21.4 4 121.0 109 4.11 2.780 18.60 1 1 4 2 ## Toyota Corona 21.5 4 120.1 97 3.70 2.465 20.01 1 0 3 1 ## Datsun 710 22.8 4 108.0 93 3.85 2.320 18.61 1 1 4 1 ## Merc 230 22.8 4 140.8 95 3.92 3.150 22.90 1 0 4 2 ## Merc 240D 24.4 4 146.7 62 3.69 3.190 20.00 1 0 4 2 ## Porsche 914-2 26.0 4 120.3 91 4.43 2.140 16.70 0 1 5 2 ## Fiat X1-9 27.3 4 79.0 66 4.08 1.935 18.90 1 1 4 1 ## Honda Civic 30.4 4 75.7 52 4.93 1.615 18.52 1 1 4 2 ## Lotus Europa 30.4 4 95.1 113 3.77 1.513 16.90 1 1 5 2 ## Fiat 128 32.4 4 78.7 66 4.08 2.200 19.47 1 1 4 1 ## Toyota Corolla 33.9 4 71.1 65 4.22 1.835 19.90 1 1 4 1 # 降冪排序 arrange(mtcars, desc(mpg)) ## mpg cyl disp hp drat wt qsec vs am gear carb ## Toyota Corolla 33.9 4 71.1 65 4.22 1.835 19.90 1 1 4 1 ## Fiat 128 32.4 4 78.7 66 4.08 2.200 19.47 1 1 4 1 ## Honda Civic 30.4 4 75.7 52 4.93 1.615 18.52 1 1 4 2 ## Lotus Europa 30.4 4 95.1 113 3.77 1.513 16.90 1 1 5 2 ## Fiat X1-9 27.3 4 79.0 66 4.08 1.935 18.90 1 1 4 1 ## Porsche 914-2 26.0 4 120.3 91 4.43 2.140 16.70 0 1 5 2 ## Merc 240D 24.4 4 146.7 62 3.69 3.190 20.00 1 0 4 2 ## Datsun 710 22.8 4 108.0 93 3.85 2.320 18.61 1 1 4 1 ## Merc 230 22.8 4 140.8 95 3.92 3.150 22.90 1 0 4 2 ## Toyota Corona 21.5 4 120.1 97 3.70 2.465 20.01 1 0 3 1 ## Hornet 4 Drive 21.4 6 258.0 110 3.08 3.215 19.44 1 0 3 1 ## Volvo 142E 21.4 4 121.0 109 4.11 2.780 18.60 1 1 4 2 ## Mazda RX4 21.0 6 160.0 110 3.90 2.620 16.46 0 1 4 4 ## Mazda RX4 Wag 21.0 6 160.0 110 3.90 2.875 17.02 0 1 4 4 ## Ferrari Dino 19.7 6 145.0 175 3.62 2.770 15.50 0 1 5 6 ## Merc 280 19.2 6 167.6 123 3.92 3.440 18.30 1 0 4 4 ## Pontiac Firebird 19.2 8 400.0 175 3.08 3.845 17.05 0 0 3 2 ## Hornet Sportabout 18.7 8 360.0 175 3.15 3.440 17.02 0 0 3 2 ## Valiant 18.1 6 225.0 105 2.76 3.460 20.22 1 0 3 1 ## Merc 280C 17.8 6 167.6 123 3.92 3.440 18.90 1 0 4 4 ## Merc 450SL 17.3 8 275.8 180 3.07 3.730 17.60 0 0 3 3 ## Merc 450SE 16.4 8 275.8 180 3.07 4.070 17.40 0 0 3 3 ## Ford Pantera L 15.8 8 351.0 264 4.22 3.170 14.50 0 1 5 4 ## Dodge Challenger 15.5 8 318.0 150 2.76 3.520 16.87 0 0 3 2 ## Merc 450SLC 15.2 8 275.8 180 3.07 3.780 18.00 0 0 3 3 ## AMC Javelin 15.2 8 304.0 150 3.15 3.435 17.30 0 0 3 2 ## Maserati Bora 15.0 8 301.0 335 3.54 3.570 14.60 0 1 5 8 ## Chrysler Imperial 14.7 8 440.0 230 3.23 5.345 17.42 0 0 3 4 ## Duster 360 14.3 8 360.0 245 3.21 3.570 15.84 0 0 3 4 ## Camaro Z28 13.3 8 350.0 245 3.73 3.840 15.41 0 0 3 4 ## Cadillac Fleetwood 10.4 8 472.0 205 2.93 5.250 17.98 0 0 3 4 ## Lincoln Continental 10.4 8 460.0 215 3.00 5.424 17.82 0 0 3 4 # 多重排序 arrange(mtcars, cyl, desc(mpg)) ## mpg cyl disp hp drat wt qsec vs am gear carb ## Toyota Corolla 33.9 4 71.1 65 4.22 1.835 19.90 1 1 4 1 ## Fiat 128 32.4 4 78.7 66 4.08 2.200 19.47 1 1 4 1 ## Honda Civic 30.4 4 75.7 52 4.93 1.615 18.52 1 1 4 2 ## Lotus Europa 30.4 4 95.1 113 3.77 1.513 16.90 1 1 5 2 ## Fiat X1-9 27.3 4 79.0 66 4.08 1.935 18.90 1 1 4 1 ## Porsche 914-2 26.0 4 120.3 91 4.43 2.140 16.70 0 1 5 2 ## Merc 240D 24.4 4 146.7 62 3.69 3.190 20.00 1 0 4 2 ## Datsun 710 22.8 4 108.0 93 3.85 2.320 18.61 1 1 4 1 ## Merc 230 22.8 4 140.8 95 3.92 3.150 22.90 1 0 4 2 ## Toyota Corona 21.5 4 120.1 97 3.70 2.465 20.01 1 0 3 1 ## Volvo 142E 21.4 4 121.0 109 4.11 2.780 18.60 1 1 4 2 ## Hornet 4 Drive 21.4 6 258.0 110 3.08 3.215 19.44 1 0 3 1 ## Mazda RX4 21.0 6 160.0 110 3.90 2.620 16.46 0 1 4 4 ## Mazda RX4 Wag 21.0 6 160.0 110 3.90 2.875 17.02 0 1 4 4 ## Ferrari Dino 19.7 6 145.0 175 3.62 2.770 15.50 0 1 5 6 ## Merc 280 19.2 6 167.6 123 3.92 3.440 18.30 1 0 4 4 ## Valiant 18.1 6 225.0 105 2.76 3.460 20.22 1 0 3 1 ## Merc 280C 17.8 6 167.6 123 3.92 3.440 18.90 1 0 4 4 ## Pontiac Firebird 19.2 8 400.0 175 3.08 3.845 17.05 0 0 3 2 ## Hornet Sportabout 18.7 8 360.0 175 3.15 3.440 17.02 0 0 3 2 ## Merc 450SL 17.3 8 275.8 180 3.07 3.730 17.60 0 0 3 3 ## Merc 450SE 16.4 8 275.8 180 3.07 4.070 17.40 0 0 3 3 ## Ford Pantera L 15.8 8 351.0 264 4.22 3.170 14.50 0 1 5 4 ## Dodge Challenger 15.5 8 318.0 150 2.76 3.520 16.87 0 0 3 2 ## Merc 450SLC 15.2 8 275.8 180 3.07 3.780 18.00 0 0 3 3 ## AMC Javelin 15.2 8 304.0 150 3.15 3.435 17.30 0 0 3 2 ## Maserati Bora 15.0 8 301.0 335 3.54 3.570 14.60 0 1 5 8 ## Chrysler Imperial 14.7 8 440.0 230 3.23 5.345 17.42 0 0 3 4 ## Duster 360 14.3 8 360.0 245 3.21 3.570 15.84 0 0 3 4 ## Camaro Z28 13.3 8 350.0 245 3.73 3.840 15.41 0 0 3 4 ## Cadillac Fleetwood 10.4 8 472.0 205 2.93 5.250 17.98 0 0 3 4 ## Lincoln Continental 10.4 8 460.0 215 3.00 5.424 17.82 0 0 3 4 11.2.5 summarise() - 資料彙總 summarise()用於計算摘要統計量。 # 基本彙總 summarise(mtcars, count = n(), avg_mpg = mean(mpg), sd_mpg = sd(mpg), max_hp = max(hp) ) ## count avg_mpg sd_mpg max_hp ## 1 32 20.09062 6.026948 335 # 配合group_by進行分組彙總 mtcars %&gt;% group_by(cyl) %&gt;% summarise( count = n(), avg_mpg = mean(mpg), avg_hp = mean(hp) ) ## # A tibble: 3 × 4 ## cyl count avg_mpg avg_hp ## &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 4 11 26.7 82.6 ## 2 6 7 19.7 122. ## 3 8 14 15.1 209. 11.2.6 group_by() - 分組操作 group_by()用於對資料進行分組。 # 分組後進行多重操作 mtcars %&gt;% group_by(cyl, gear) %&gt;% summarise( count = n(), avg_mpg = mean(mpg), .groups = &#39;drop&#39; ) ## # A tibble: 8 × 4 ## cyl gear count avg_mpg ## &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; ## 1 4 3 1 21.5 ## 2 4 4 8 26.9 ## 3 4 5 2 28.2 ## 4 6 3 2 19.8 ## 5 6 4 4 19.8 ## 6 6 5 1 19.7 ## 7 8 3 12 15.0 ## 8 8 5 2 15.4 # 分組後篩選，ungroup()移除分組，資料框恢復為未分組狀態 mtcars %&gt;% group_by(cyl) %&gt;% filter(mpg == max(mpg)) %&gt;% ungroup() ## # A tibble: 3 × 11 ## mpg cyl disp hp drat wt qsec vs am gear carb ## &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 21.4 6 258 110 3.08 3.22 19.4 1 0 3 1 ## 2 33.9 4 71.1 65 4.22 1.84 19.9 1 1 4 1 ## 3 19.2 8 400 175 3.08 3.84 17.0 0 0 3 2 11.2.7 slice() - 選擇特定列 slice()用於選擇特定的資料列。 # 選擇前幾列 slice(mtcars, 1:5) ## mpg cyl disp hp drat wt qsec vs am gear carb ## Mazda RX4 21.0 6 160 110 3.90 2.620 16.46 0 1 4 4 ## Mazda RX4 Wag 21.0 6 160 110 3.90 2.875 17.02 0 1 4 4 ## Datsun 710 22.8 4 108 93 3.85 2.320 18.61 1 1 4 1 ## Hornet 4 Drive 21.4 6 258 110 3.08 3.215 19.44 1 0 3 1 ## Hornet Sportabout 18.7 8 360 175 3.15 3.440 17.02 0 0 3 2 # 選擇最後幾列 slice(mtcars, (n()-4):n()) ## mpg cyl disp hp drat wt qsec vs am gear carb ## Lotus Europa 30.4 4 95.1 113 3.77 1.513 16.9 1 1 5 2 ## Ford Pantera L 15.8 8 351.0 264 4.22 3.170 14.5 0 1 5 4 ## Ferrari Dino 19.7 6 145.0 175 3.62 2.770 15.5 0 1 5 6 ## Maserati Bora 15.0 8 301.0 335 3.54 3.570 14.6 0 1 5 8 ## Volvo 142E 21.4 4 121.0 109 4.11 2.780 18.6 1 1 4 2 # 隨機抽樣 set.seed(123) slice_sample(mtcars, n = 5) ## mpg cyl disp hp drat wt qsec vs am gear carb ## Maserati Bora 15.0 8 301.0 335 3.54 3.570 14.60 0 1 5 8 ## Cadillac Fleetwood 10.4 8 472.0 205 2.93 5.250 17.98 0 0 3 4 ## Honda Civic 30.4 4 75.7 52 4.93 1.615 18.52 1 1 4 2 ## Merc 450SLC 15.2 8 275.8 180 3.07 3.780 18.00 0 0 3 3 ## Datsun 710 22.8 4 108.0 93 3.85 2.320 18.61 1 1 4 1 # 按比例抽樣 slice_sample(mtcars, prop = 0.1) ## mpg cyl disp hp drat wt qsec vs am gear carb ## Merc 280 19.2 6 167.6 123 3.92 3.44 18.30 1 0 4 4 ## Fiat 128 32.4 4 78.7 66 4.08 2.20 19.47 1 1 4 1 ## Dodge Challenger 15.5 8 318.0 150 2.76 3.52 16.87 0 0 3 2 11.3 tidyr核心函數 11.3.1 pivot_longer() - 寬轉長 pivot_longer()用於將資料從寬格式轉換為長格式。 # 建立範例資料 sales_data &lt;- data.frame( 月份 = c(&quot;1月&quot;, &quot;2月&quot;, &quot;3月&quot;), 產品A = c(100, 120, 130), 產品B = c(80, 90, 95), 產品C = c(150, 160, 170) ) print(sales_data) ## 月份 產品A 產品B 產品C ## 1 1月 100 80 150 ## 2 2月 120 90 160 ## 3 3月 130 95 170 # 寬轉長 sales_long &lt;- pivot_longer( sales_data, cols = 產品A:產品C, names_to = &quot;產品&quot;, values_to = &quot;銷售額&quot; ) print(sales_long) ## # A tibble: 9 × 3 ## 月份 產品 銷售額 ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 1月 產品A 100 ## 2 1月 產品B 80 ## 3 1月 產品C 150 ## 4 2月 產品A 120 ## 5 2月 產品B 90 ## 6 2月 產品C 160 ## 7 3月 產品A 130 ## 8 3月 產品B 95 ## 9 3月 產品C 170 11.3.2 pivot_wider() - 長轉寬 pivot_wider()用於將資料從長格式轉換為寬格式。 # 將長格式資料轉回寬格式 sales_wide &lt;- pivot_wider( sales_long, names_from = 產品, values_from = 銷售額 ) print(sales_wide) ## # A tibble: 3 × 4 ## 月份 產品A 產品B 產品C ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 1月 100 80 150 ## 2 2月 120 90 160 ## 3 3月 130 95 170 11.3.3 separate() - 分割欄位 separate()用於將一個欄位分割為多個欄位。 # 建立範例資料 name_data &lt;- data.frame( 姓名 = c(&quot;張三_25_男&quot;, &quot;李四_30_女&quot;, &quot;王五_28_男&quot;) ) # 分割欄位 name_separated &lt;- separate( name_data, col = 姓名, into = c(&quot;姓名&quot;, &quot;年齡&quot;, &quot;性別&quot;), sep = &quot;_&quot; ) print(name_separated) ## 姓名 年齡 性別 ## 1 張三 25 男 ## 2 李四 30 女 ## 3 王五 28 男 11.3.4 unite() - 合併欄位 unite()用於將多個欄位合併為一個欄位。 # 將分割的欄位重新合併 name_united &lt;- unite( name_separated, col = &quot;個人資料&quot;, 姓名, 年齡, 性別, sep = &quot;-&quot; ) print(name_united) ## 個人資料 ## 1 張三-25-男 ## 2 李四-30-女 ## 3 王五-28-男 11.3.5 drop_na() - 刪除缺失值 drop_na()用於刪除包含缺失值的列。 # 建立包含缺失值的資料 missing_data &lt;- data.frame( A = c(1, 2, NA, 4), B = c(NA, 2, 3, 4), C = c(1, 2, 3, 4) ) # 刪除任何包含缺失值的列 drop_na(missing_data) ## A B C ## 1 2 2 2 ## 2 4 4 4 # 只刪除特定欄位的缺失值 drop_na(missing_data, A) ## A B C ## 1 1 NA 1 ## 2 2 2 2 ## 3 4 4 4 11.3.6 fill() - 填補缺失值 fill()用於用前一個或後一個值填補缺失值。 # 建立時間序列資料 time_data &lt;- data.frame( 時間 = 1:6, 數值 = c(10, NA, NA, 40, NA, 60) ) # 向下填補 fill(time_data, 數值, .direction = &quot;down&quot;) ## 時間 數值 ## 1 1 10 ## 2 2 10 ## 3 3 10 ## 4 4 40 ## 5 5 40 ## 6 6 60 # 向上填補 fill(time_data, 數值, .direction = &quot;up&quot;) ## 時間 數值 ## 1 1 10 ## 2 2 40 ## 3 3 40 ## 4 4 40 ## 5 5 60 ## 6 6 60 11.3.7 replace_na() - 替換缺失值 replace_na()用於特定值替換缺失值。 # 建立包含缺失值的資料 na_data &lt;- data.frame( X = c(1, NA, 3, NA, 5), Y = c(NA, 2, NA, 4, NA) ) # 替換缺失值 replace_na(na_data, list(X = 0, Y = -999)) ## X Y ## 1 1 -999 ## 2 0 2 ## 3 3 -999 ## 4 0 4 ## 5 5 -999 # 使用平均值替換 na_data %&gt;% mutate( X = replace_na(X, mean(X, na.rm = TRUE)), Y = replace_na(Y, mean(Y, na.rm = TRUE)) ) ## X Y ## 1 1 3 ## 2 3 2 ## 3 3 3 ## 4 3 4 ## 5 5 3 11.4 常用技巧與綜合應用 11.4.1 管道操作符%&gt;%的使用 # 管道操作讓程式碼更易讀 result &lt;- mtcars %&gt;% filter(cyl == 6) %&gt;% select(mpg, hp, wt) %&gt;% mutate(馬力重量比 = hp / wt) %&gt;% arrange(desc(馬力重量比)) head(result) ## mpg hp wt 馬力重量比 ## Ferrari Dino 19.7 175 2.770 63.17690 ## Mazda RX4 21.0 110 2.620 41.98473 ## Mazda RX4 Wag 21.0 110 2.875 38.26087 ## Merc 280 19.2 123 3.440 35.75581 ## Merc 280C 17.8 123 3.440 35.75581 ## Hornet 4 Drive 21.4 110 3.215 34.21462 11.4.2 處理因子變數 # 在dplyr中處理因子變數 mtcars %&gt;% mutate( cyl_factor = factor(cyl, levels = c(4, 6, 8), labels = c(&quot;四缸&quot;, &quot;六缸&quot;, &quot;八缸&quot;)) ) %&gt;% count(cyl_factor) ## cyl_factor n ## 1 四缸 11 ## 2 六缸 7 ## 3 八缸 14 11.4.3 資料清理流程 # 使用mtcars資料集進行分析 mtcars_analysis &lt;- mtcars %&gt;% # 新增分類變數 mutate( 性能等級 = case_when( hp &gt; 150 ~ &quot;高性能&quot;, hp &gt; 100 ~ &quot;中等性能&quot;, TRUE ~ &quot;一般性能&quot; ), 油耗等級 = ifelse(mpg &gt; 20, &quot;省油&quot;, &quot;耗油&quot;) ) %&gt;% # 分組彙總 group_by(cyl, 性能等級, 油耗等級) %&gt;% summarise( 車輛數 = n(), 平均馬力 = mean(hp), 平均油耗 = mean(mpg), .groups = &#39;drop&#39; ) %&gt;% # 長轉寬以便展示 pivot_wider( names_from = 油耗等級, values_from = 車輛數:平均油耗, values_fill = 0 ) print(mtcars_analysis) ## # A tibble: 6 × 8 ## cyl 性能等級 車輛數_省油 車輛數_耗油 平均馬力_省油 平均馬力_耗油 ## &lt;dbl&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 4 一般性能 9 0 76.3 0 ## 2 4 中等性能 2 0 111 0 ## 3 6 中等性能 3 3 110 117 ## 4 6 高性能 0 1 0 175 ## 5 8 中等性能 0 2 0 150 ## 6 8 高性能 0 12 0 219. ## # ℹ 2 more variables: 平均油耗_省油 &lt;dbl&gt;, 平均油耗_耗油 &lt;dbl&gt; 11.5 延伸學習 dplyr和tidyr套件提供了許多強大的函數，本章僅介紹了最常用核心函數。為了更深入學習和查閱所有可用函數，強烈推薦使用官方提供的速查表（Cheatsheets）。 官方主頁: https://rstudio.github.io/cheatsheets/ 中文版速查表 dplyr速查表: https://rstudio.github.io/cheatsheets/translations/chinese/data-transformation_zh_cn.pdf tidyr速查表: https://rstudio.github.io/cheatsheets/translations/chinese/tidyr_zh_cn.pdf "],["data.html", "Chapter 12 data.table運用 12.1 簡介 12.2 data.table基礎 12.3 常用函數與操作 12.4 高效數據讀寫與平行處理 12.5 進階技巧 12.6 效能比較 12.7 總結", " Chapter 12 data.table運用 12.1 簡介 data.table套件是R語言中用於數據處理的強大工具，它提供了data.table的高效能替代方案，特別適合處理大型數據集（例如1GB到100GB）。data.table在語法上具有簡潔且高效的特性，能夠在記憶體中快速完成數據整型操作。 本章將介紹data.table的最常用函數，並重點說明如何在讀取與寫入大量數據時使用多個平行緒處理來加速操作。 12.2 data.table基礎 12.2.1 安裝與載入 library(data.table) # 載入套件 12.2.2 基本語法 data.table的通用格式為：DT[i, j, by]對於數據集DT，選取子集行i，通過by分組計算j 這種語法可以理解為： i：選擇行（類似SQL中的WHERE） j：選擇列或進行計算（類似SQL中的SELECT） by：分組變量（類似SQL中的GROUP BY） 12.3 常用函數與操作 12.3.1 創建data.table # 從頭創建data.table DT &lt;- data.table( ID = 1:5, Name = c(&quot;John&quot;, &quot;Mary&quot;, &quot;James&quot;, &quot;Linda&quot;, &quot;Robert&quot;), Age = c(25, 32, 41, 29, 35), Score = c(78, 92, 85, 67, 88) ) # 從data.frame轉換 setDT(DT) # 直接轉換，比as.data.table更快[citation:7] # 複製data.table（防止直接修改原數據） DT_copy &lt;- data.table::copy(DT) # 防止原數據被改變[citation:7] 12.3.2 行選擇（i部分） # 基於數值位置選擇 DT[3:5] # 選擇第3到第5行 ## ID Name Age Score ## &lt;int&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt; ## 1: 3 James 41 85 ## 2: 4 Linda 29 67 ## 3: 5 Robert 35 88 # 基於條件選擇 DT[Age &gt; 30] # 選擇年齡大於30的行 ## ID Name Age Score ## &lt;int&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt; ## 1: 2 Mary 32 92 ## 2: 3 James 41 85 ## 3: 5 Robert 35 88 DT[Name %in% c(&quot;John&quot;, &quot;Mary&quot;)] # 選擇姓名為John或Mary的行 ## ID Name Age Score ## &lt;int&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt; ## 1: 1 John 25 78 ## 2: 2 Mary 32 92 DT[Score %between% c(80, 90)] # 選擇分數在80到90之間的行[citation:7] ## ID Name Age Score ## &lt;int&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt; ## 1: 3 James 41 85 ## 2: 5 Robert 35 88 # 多條件組合 DT[Age &gt; 25 &amp; Score &gt; 80] # 年齡大於25且分數大於80 ## ID Name Age Score ## &lt;int&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt; ## 1: 2 Mary 32 92 ## 2: 3 James 41 85 ## 3: 5 Robert 35 88 12.3.3 列操作（j部分） # 選擇單列 DT[, Name] # 返回向量 ## [1] &quot;John&quot; &quot;Mary&quot; &quot;James&quot; &quot;Linda&quot; &quot;Robert&quot; DT[, .(Name)] # 返回data.table ## Name ## &lt;char&gt; ## 1: John ## 2: Mary ## 3: James ## 4: Linda ## 5: Robert # 選擇多列 DT[, .(Name, Score)] # 選擇姓名和分數列 ## Name Score ## &lt;char&gt; &lt;num&gt; ## 1: John 78 ## 2: Mary 92 ## 3: James 85 ## 4: Linda 67 ## 5: Robert 88 DT[, c(&quot;Name&quot;, &quot;Score&quot;)] # 另一種寫法 ## Name Score ## &lt;char&gt; &lt;num&gt; ## 1: John 78 ## 2: Mary 92 ## 3: James 85 ## 4: Linda 67 ## 5: Robert 88 # 計算統計量 DT[, mean(Score)] # 計算平均分數 ## [1] 82 DT[, .(Mean_Score = mean(Score), SD_Score = sd(Score))] # 多個統計量 ## Mean_Score SD_Score ## &lt;num&gt; &lt;num&gt; ## 1: 82 9.823441 # 使用特殊符號.N（計數） DT[, .N] # 返回總行數[citation:1] ## [1] 5 DT[Age &gt; 30, .N] # 年齡大於30的人數 ## [1] 3 12.3.4 添加、修改和刪除列 # 添加新列 DT[, Grade := ifelse(Score &gt;= 80, &quot;A&quot;, &quot;B&quot;)] # 根據分數添加等級列 # 同時添加多列 DT[, `:=`( Score_1 = Score / 10, Score_2 = Score / 100, AgeG1 = cut(Age, breaks = c(0, 30, 40, 100)), AgeG2 = cut(Age, breaks = c(0, 30, 40, 100)) )] # 修改列 DT[, Grade := &quot;A&quot;] # 將所有等級設為A # 刪除列 DT[, Score_1 := NULL] # 刪除等級列 DT[, c(&quot;Score_2&quot;, &quot;AgeG2&quot;) := NULL] # 刪除多列 :=運算符直接在原數據上增加新列或替換舊列，無需額外賦值 12.3.5 分組操作（by部分） # 基本分組計算 DT[, .(Avg_Score = mean(Score)), by = AgeG1] # 按年齡組計算平均分數 ## AgeG1 Avg_Score ## &lt;fctr&gt; &lt;num&gt; ## 1: (0,30] 72.5 ## 2: (30,40] 90.0 ## 3: (40,100] 85.0 # 多個分組變量 DT[, .(Count = .N, Mean_Score = mean(Score)), by = .(AgeG1, Grade)] ## AgeG1 Grade Count Mean_Score ## &lt;fctr&gt; &lt;char&gt; &lt;int&gt; &lt;num&gt; ## 1: (0,30] A 2 72.5 ## 2: (30,40] A 2 90.0 ## 3: (40,100] A 1 85.0 # 分組後取每組第一行和最後一行 DT[, .SD[1], by = AgeG1] # 每組第一行[citation:7] ## AgeG1 ID Name Age Score Grade ## &lt;fctr&gt; &lt;int&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;char&gt; ## 1: (0,30] 1 John 25 78 A ## 2: (30,40] 2 Mary 32 92 A ## 3: (40,100] 3 James 41 85 A DT[, .SD[.N], by =AgeG1] # 每組最後一行[citation:7] ## AgeG1 ID Name Age Score Grade ## &lt;fctr&gt; &lt;int&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;char&gt; ## 1: (0,30] 4 Linda 29 67 A ## 2: (30,40] 5 Robert 35 88 A ## 3: (40,100] 3 James 41 85 A # 分組後排序 DT[order(AgeG1, -Score)] # 先按年齡組升序，再按分數降序 ## ID Name Age Score Grade AgeG1 ## &lt;int&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;char&gt; &lt;fctr&gt; ## 1: 1 John 25 78 A (0,30] ## 2: 4 Linda 29 67 A (0,30] ## 3: 2 Mary 32 92 A (30,40] ## 4: 5 Robert 35 88 A (30,40] ## 5: 3 James 41 85 A (40,100] 12.3.6 排序函數 # 基本排序 setorder(DT, Age) # 按年齡升序 setorder(DT, -Score) # 按分數降序 setorder(DT, AgeG1, -Score) # 先按年齡組升序，再按分數降序[citation:7] # 使用frank進行排名 DT[, Rank := frank(-Score, ties.method = &quot;min&quot;)] # 按分數排名（分數高者排名靠前） 12.4 高效數據讀寫與平行處理 12.4.1 讀取大型數據文件 data.table的fread函數是讀取大型數據文件的最佳工具，它自動使用多線程加速讀取過程： # 基本讀取 large_data &lt;- fread(&quot;data/large_data.csv&quot;) # 指定參數優化讀取 large_data &lt;- fread(&quot;data/large_data.csv&quot;, nThread = getDTthreads(), # 使用所有可用線程 showProgress = TRUE, # 顯示進度條 verbose = TRUE) # 顯示詳細信息 12.4.2 寫入數據文件 同樣地，fwrite函數也使用多線程技術加速數據寫入： # 基本寫入 fwrite(large_data, &quot;data/output/output_dataset.csv&quot;) # 指定參數優化寫入 fwrite(large_data, &quot;data/output/output_dataset.csv&quot;, nThread = getDTthreads(), # 使用所有可用線程 showProgress = TRUE) # 顯示進度條 12.4.3 控制平行處理線程數 data.table允許您控制和優化平行處理的線程數： # 查看當前線程數 getDTthreads() ## [1] 6 # 設置線程數（通常設為可用核心數） setDTthreads(percent = 100) # 使用100%的可用核心 setDTthreads(threads = 8) # 明確設置使用8個線程 # 還原為默認設置 setDTthreads(percent = 50) # 使用50%的可用核心 12.4.4 實際應用範例 以下是一個完整的實際應用範例，展示如何處理大型數據集： # 加載套件 library(data.table) # 設置使用多線程（使用所有可用核心） setDTthreads(percent = 100) # 讀取大型CSV文件（自動使用多線程） start_time &lt;- Sys.time() large_dt &lt;- fread(&quot;data/large_data.csv&quot;, nThread = getDTthreads(), showProgress = TRUE) read_time &lt;- Sys.time() - start_time print(paste(&quot;讀取時間：&quot;, read_time)) # 數據處理 # 1. 選擇需要的列 processed_dt &lt;- large_dt[, .(ID, Date, Amount, Category)] # 2. 過濾數據 processed_dt &lt;- processed_dt[Amount &gt; 0 &amp; !is.na(Category)] # 3. 添加新列 processed_dt[, `:=`( Year = year(Date), Month = month(Date), Amount_USD = Amount * 0.85 # 假設匯率轉換 )] # 4. 分組匯總 summary_dt &lt;- processed_dt[, .( Total_Amount = sum(Amount), Avg_Amount = mean(Amount), Transaction_Count = .N ), by = .(Category, Year, Month)] # 5. 排序結果 setorder(summary_dt, Year, Month, -Total_Amount) # 寫出處理後的數據（使用多線程） start_time &lt;- Sys.time() fwrite(summary_dt, &quot;data/summary_data.csv&quot;, nThread = getDTthreads(), showProgress = TRUE) write_time &lt;- Sys.time() - start_time print(paste(&quot;寫入時間：&quot;, write_time)) 12.5 進階技巧 12.5.1 快速合併數據 # 創建兩個範例數據表 DT1 &lt;- data.table(ID = 1:5, Name = c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;)) DT2 &lt;- data.table(ID = 3:7, Score = c(78, 92, 85, 67, 88)) # 合併數據 merged_DT &lt;- merge(DT1, DT2, by = &quot;ID&quot;, all.x = TRUE) # 左連接 12.5.2 非重複計數 # 計算唯一值數量 uniqueN(DT$Category) # 相當於length(unique(DT$Category))但更快[citation:1] # 按組計算唯一值 DT[, .(Unique_Count = uniqueN(Name)), by = Category] 12.5.3 條件判斷函數 # fifelse比base::ifelse更快 DT[, Result := fifelse(Score &gt;= 80, &quot;Pass&quot;, &quot;Fail&quot;)] # fcase類似SQL中的CASE WHEN DT[, Grade := fcase( Score &gt;= 90, &quot;A&quot;, Score &gt;= 80, &quot;B&quot;, Score &gt;= 70, &quot;C&quot;, default = &quot;F&quot; )][citation:1] 12.6 效能比較 為了展示data.table的效能優勢，以下是一個簡單的比較範例： library(data.table) library(microbenchmark) # 創建大型測試數據 set.seed(123) n &lt;- 1e6 # 100萬行 large_df &lt;- data.frame( ID = 1:n, Group = sample(letters, n, replace = TRUE), Value1 = rnorm(n), Value2 = rnorm(n) ) large_dt &lt;- as.data.table(large_df) # 比較分組計算速度 mb_results &lt;- microbenchmark( data.table = large_dt[, .(Mean = mean(Value1)), by = Group], data.frame = aggregate(Value1 ~ Group, data = large_df, FUN = mean), times = 10 ) print(mb_results) 12.7 總結 本章介紹了data.table套件的核心功能，重點包括： 基本語法：DT[i, j, by]三段式操作 常用函數：行選擇、列操作、分組計算、排序等 高效讀寫：使用fread和fwrite進行多線程數據讀寫 -平行處理：通過setDTthreads控制線程數以優化效能 data.table在處理大型數據集時表現出色，特別是當您充分利用其多線程讀寫能力時，可以大幅提升數據處理效率。對於需要處理GB級別數據的用戶來說，掌握data.table是非常值得的投資。 在實際應用中，建議根據您的硬件配置調整線程數，並充分利用fread和fwrite的自動平行處理功能，這樣可以在I/O密集型操作中獲得最大效能提升。 "],["ggplot2繪圖.html", "Chapter 13 ggplot2繪圖 13.1 簡介 13.2 基本概念與語法 13.3 ggplot2 注意事項", " Chapter 13 ggplot2繪圖 13.1 簡介 在 R 語言的資料視覺化領域中，ggplot2 套件無疑是最受歡迎且功能最強大的選擇。它是由 Hadley Wickham 開發，基於 Leland Wilkinson 的《圖形文法》（Grammar of Graphics）概念所設計。 這個文法的核心思想是：任何一張統計圖表都可以分解為幾個獨立的元件： 資料 (Data)：：原始資料集，必須是 data.frame 格式。 美學映射 (Aesthetics, aes)：：決定圖表的類型，例如點 (point)、線 (line)、長條 (bar)、箱型圖 (boxplot) 等。 統計轉換 (Statistics, stat)：：在繪圖前對資料進行的統計計算（例如計算平均值、計數）。 尺度 (Scales)：：控制美學映射的具體表現（例如 X 軸的範圍、顏色的選用）。 座標系統 (Coordinate System)： 圖表的佈局（例如笛卡爾座標、極座標）。 分面 (Faceting)： 將圖表依據某個變數分割成多個子圖。 掌握了這七個元件，就能像組裝積木一樣，建立出任何想要的圖表。 13.1.1 安裝與加載 # 安裝ggplot2 #install.packages(&quot;ggplot2&quot;) # 加載包 library(ggplot2) 13.2 基本概念與語法 13.2.1 核心組件 ggplot2繪圖包含三個基本要素： 數據(Data)：必須是data.frame格式，且最好是”整潔”(tidy)數據 映射(Mapping)：數據變量與圖形屬性的對應關係，使用aes()定義 圖層(Layer)：至少需要一個圖層來渲染觀察值，如geom_point() 13.2.2 基本語法模板 其標準模板如下： ggplot(data = 資料框, aes(x = 變數1, y = 變數2)) + geom_xxx() + labs(title = &quot;...&quot;, x = &quot;...&quot;, y = &quot;...&quot;) + theme_minimal() 使用 R 內建的 iris 資料集進行示範 # 繪製花瓣長度 (Petal.Length) 與花瓣寬度 (Petal.Width) 的散點圖 ggplot(data = iris) + geom_point( mapping = aes(x = Petal.Length, y = Petal.Width, color = Species) ) + labs( title = &quot;鳶尾花花瓣尺寸散點圖&quot;, x = &quot;花瓣長度 (公分)&quot;, y = &quot;花瓣寬度 (公分)&quot;, color = &quot;花卉種類&quot; ) 語法邏輯： ggplot()：決定資料來源與 x、y 映射 geom_xxx()：決定圖的類型 labs()：設定標題、座標軸標籤 theme_xxx()：設定版面風格 13.2.3 常用幾何圖層（geom） 以下整理所有 ggplot2 最常用的 geom： 圖形類型 幾何函式 適用情境 散佈圖 geom_point() 連續 × 連續 折線圖 geom_line() 時間序列 長條圖 geom_col()、geom_bar() 類別變數比較 直方圖 geom_histogram() 單一連續變數 密度圖 geom_density() 分布比較 盒鬚圖 geom_boxplot() 類別 × 連續，比較分布 次數統計 geom_count() 有重複點的散佈圖 13.2.3.1 散點圖與平滑曲線 ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + geom_point(mapping = aes(color = class)) + geom_smooth(se = FALSE) 13.2.3.2 柱狀圖 # 計數柱狀圖 ggplot(data = diamonds) + geom_bar(mapping = aes(x = cut)) # 指定y值的柱狀圖 demo &lt;- data.frame( category = c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;), value = c(20, 30, 40) ) ggplot(data = demo) + geom_bar(mapping = aes(x = category, y = value), stat = &quot;identity&quot;) 13.2.3.3 箱形圖 # 箱形圖 ggplot(data = iris) + geom_boxplot(mapping = aes(x = Species, y = Petal.Length)) # 箱形圖加上抖動點 ggplot(data = iris) + geom_boxplot(mapping = aes(x = Species, y = Petal.Length)) + geom_jitter(mapping = aes(x = Species, y = Petal.Length), width = 0.2) 13.2.3.4 小提琴圖 # 小提琴圖 ggplot(data = iris) + geom_violin(mapping = aes(x = Species, y = Petal.Length)) 13.2.3.5 密度圖 # 密度圖 ggplot(data = iris) + geom_density(mapping = aes(x = Petal.Length, colour = Species)) 13.2.4 分面系統 分面(Facets)可將數據按分類變量分成多個子圖 13.2.4.1 單變量分面 ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy)) + facet_wrap(~ class, nrow = 2) 13.2.4.2 雙變量分面 ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy)) + facet_grid(drv ~ cyl) 注意事項： 使用連續變量分面會將其轉換為因子，可能產生大量子圖 分面適合類別較多的情況，但可能降低不同組別間的比較便利性 13.2.5 標籤與標度 13.2.5.1 添加標籤 ggplot(data = iris, mapping = aes(x = Sepal.Length, y = Sepal.Width)) + geom_point(mapping = aes(color = Species)) + labs( title = &quot;鳶尾花萼片尺寸關係&quot;, subtitle = &quot;不同物種的比較&quot;, x = &quot;萼片長度&quot;, y = &quot;萼片寬度&quot;, caption = &quot;數據來源: Iris數據集&quot;, color = &quot;物種&quot; ) 13.2.5.2 標度調整 library(scales) ggplot(data = iris, mapping = aes(x = Sepal.Length, y = Sepal.Width)) + geom_point() + scale_x_log10(labels = label_log()) + scale_y_continuous(limits = c(2, 5)) + labs(x = &quot;萼片長度(對數尺度)&quot;, y = &quot;萼片寬度&quot;) 13.2.6 坐標系統與主題 13.2.6.1 坐標系統 # 翻轉坐標軸 ggplot(data = mpg) + geom_boxplot(mapping = aes(x = class, y = hwy)) + coord_flip() 13.2.6.2 主題設置 # 使用內置主題 p &lt;- ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + geom_point(mapping = aes(color = class)) p + theme_bw() # 黑白主題 p + theme_minimal() # 極簡主題 13.2.6.3 圖例控制 使用guides()函數控制圖例外觀 # 自定義圖例 ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = factor(cyl))) + geom_point() + guides(color = guide_legend( title = &quot;氣缸數&quot;, title.position = &quot;top&quot;, label.position = &quot;left&quot;, label.hjust = 1 )) 13.2.6.4 實戰案例：探索Gapminder數據 # 如果沒有gapminder包，請先安裝: install.packages(&quot;gapminder&quot;) library(gapminder) # 提取2007年數據 gapminder_2007 &lt;- gapminder[gapminder$year == 2007, ] ggplot(data = gapminder_2007, mapping = aes(x = gdpPercap, y = lifeExp, size = pop, color = continent)) + geom_point(alpha = 0.7) + scale_x_log10(labels = label_dollar()) + labs( title = &quot;2007年各國人均GDP與預期壽命關係&quot;, x = &quot;人均GDP(對數尺度)&quot;, y = &quot;出生時預期壽命(歲)&quot;, size = &quot;人口數量&quot;, color = &quot;大洲&quot; ) + theme_minimal() 13.2.7 進階技巧 13.2.7.1 多圖層疊加 # 全局映射與局部映射 ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + geom_point(mapping = aes(color = class)) + geom_smooth(se = FALSE, color = &quot;black&quot;) + facet_wrap(~ year) 13.2.7.2 統計變換 # 使用統計變換 ggplot(data = diamonds) + stat_summary( mapping = aes(x = cut, y = depth), fun.min = min, fun.max = max, fun = median ) 13.3 ggplot2 注意事項 13.3.1 常見問題與解決方案 數據格式問題:：確保數據是data.frame格式，且為整潔數據。 圖例不出現：：檢查是否aes()內正確映射了圖形屬性。 點重疊嚴重：：使用geom_jitter()或geom_count()解決。 尺度 (Scales)：：控制美學映射的具體表現（例如 X 軸的範圍、顏色的選用）。 中文顯示問題： 設置主題字體家族，如theme(text = element_text(family = \"Heiti\"))。 PDF輸出問題： 確保安裝了TinyTeX或完整LaTeX發行版。 13.3.2 總結 ggplot2提供了強大而靈活的數據可視化功能。通過掌握數據映射、幾何對象、分面系統和標度控制等核心概念，你可以創建出高質量的統計圖形。建議進一步學習ggplot2的官方文檔和相關書籍以深入了解高級功能。 "]]
