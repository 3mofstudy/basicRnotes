# 資料輸入與輸出

## 資料鍵入與印出

### 資料鍵入

在 R 語言中，當我們需要讓使用者從鍵盤輸入資料時，最常用的基礎函數就是 scan() 和 readline()

1.  `scan()`：常用於從標準輸入（鍵盤）或文件中讀取一連串相同類型的資料，並將其儲存為一個向量 (Vector)。

```{r eval=FALSE}
# 範例一：輸入數字向量
ages <- scan() # 預設讀取數字 (依序輸入數值，完成後請按兩次 Enter)"
print("您輸入的資料為：")
print(ages)

# 範例二：輸入文字向量
# 指定讀取文字(依序輸入三個最喜歡的水果，完成後請按兩次 Enter)
fruits <- scan(what = character()) 
print("您喜歡的水果列表：")
print(favorite_fruits)

```

2.  `readline("請輸入字串:")`：用於提示使用者輸入一段文字，並將整行輸入作為一個單一的字串 (character string) 儲存。

### 資料印出

-   print() 和cat()，都可以把資料打印到Console螢幕上

-   print()只能輸出一個完整文字訊息，如果想要利用print() 輸出一段話+某變數，就必須另外使用paste()或paste0()將兩個訊息結合成一個完整文字訊息才能用print()進行輸出。

-   但cat()可直接用"," 來結合文字或物件即可輸出，範例如下:

1.  `cat()`

```{r eval=T}
name = "Lucy"
cat( name ,"帶狗狗去公園散步了" )
```

2.  `print()`

```{r eval=T}
name = "Lucy"
print( paste(name ,"帶狗狗去公園散步了")   )
```

## 複製及貼上

有兩個套件，可以輕鬆將R輸出結果轉化到剪貼簿後，就可以直接拿到Excel或Word中複製貼上，相當方便，clipr 套件基本不用再安裝，因為已經常規預設安中好

```{r eval=FALSE}
#A.把 clipboard 中（你已經複製好）的內容存在 text 變數中 
text <-clipr::read_clip() ##轉換成純文字向量(適合單行貼上) 
DT <-clipr::read_clip_tbl() ##轉換成data.frame(適合表格貼上)

#B.本該輸出至Console的內容暫存到 clipboard 容器，就可以貼到別處(例如Excel)

clipr::write_clip(text)

```

另一個好用套件是psychTools

```{r eval=FALSE, message=FALSE, warning=FALSE}
#另一個好用套件
library(psychTools) 
text<-psychTools::read.clipboard() 
text<-psychTools::read.clipboard.tab()
```

## 資料匯入

可從RStudio 工具列 選擇 不同檔案格式 匯入，亦可輸入指令匯入

![](https://i.postimg.cc/jjzTLV5m/screenshot-9.png){width="448"}

### 匯入csv檔

```{r eval=FALSE , message=FALSE, warning=FALSE}
library(readr) #呼叫csv檔的套件 

# 方法1：使用 R 內建的 read.csv()
score = read.csv("./data/score.csv", sep=",", header=TRUE, stringsAsFactors=FALSE)
head(score)

# 方法2：使用 readr 套件的 read_csv() - 速度更快，處理大檔案更有效率
score2 = read_csv("./data/score.csv")
head(score2)

# 方法3：讀取有中文編碼的csv檔
score3 = read.csv("./data/score.csv", fileEncoding="UTF-8") # 或 "BIG5"
head(score3)

```

### 匯入excel檔

```{r eval=FALSE , message=FALSE, warning=FALSE}

library(readxl) #呼叫excel檔的套件

# 讀取第一個工作表
data1 = read_excel("data/datasets.xlsx")

head(data1)

# 讀取指定工作表 - 透過名稱
data2 = read_excel("data/datasets.xlsx", sheet = "iris")
head(data2)

# 讀取指定工作表 - 透過索引
data3 = read_excel("data/datasets.xlsx", sheet = 2)
head(data3)

# 讀取指定範圍的資料
data4 = read_excel("data/datasets.xlsx", range = "A1:C10")
head(data4)

# 跳過前幾行
data5 = read_excel("data/datasets.xlsx", skip = 2)
head(data5)

```

### 匯入json檔

```{r eval=FALSE , message=FALSE, warning=FALSE}
library(jsonlite) # 處理JSON格式資料的套件

# 從本地檔案讀取JSON資料
json_data = fromJSON("data/198_5.json")
str(json_data) # 查看資料結構

# 從URL讀取JSON資料
api_data = fromJSON("https://www-ws.pthg.gov.tw/Upload/2015pthg/0/relfile/0/0/ccb3a5fd-4754-4be4-96be-df1f50367f47.json")
head(api_data)

# 如果JSON資料是巢狀結構，可以使用flatten參數
# flat_data = fromJSON("data/data.json", flatten=TRUE)
# str(flat_data)

# 自建JSON格式
string = '{"name":"John", "age":30, "city":"New York"}'
parsed_data = fromJSON(string)
print(parsed_data)
```

### 匯入RDS檔 或載入多個R物件

RDS檔是R專有的檔案格式，具有檔案小速度快特性，而RData是多個R物件的組合檔

```{r eval=FALSE , message=FALSE, warning=FALSE}

# 讀取RDS檔案
mtcars = readRDS("data/mtcars.rds")


# 載入RData檔案
load("data/my_data.RData")  

```

## 資料匯出

### 匯出為csv檔

```{r eval=FALSE , message=FALSE, warning=FALSE}
# 方法1：使用 base R 的 write.csv()
write.csv(mtcars, "data/output/mtcars1.csv", row.names=FALSE)

# 方法2：使用 readr 套件的 write_csv() - 速度更快
library(readr)
write_csv(mtcars, "data/output/mtcars2.csv")

# 方法3：處理中文編碼
write.csv(mtcars, "data/output/mtcars3.csv", row.names=FALSE, fileEncoding="UTF-8")
```

### 匯出為excel檔

要匯出 Excel，建議使用 openxlsx 或 writexl 套件。

#### 方法 1：使用 writexl

```{r eval=FALSE , message=FALSE, warning=FALSE}
install.packages("writexl") #安裝 writexl套件
library(writexl)

# 函數參數介紹 
write_xlsx(
  x,                           # 要輸出的資料（data frame 或 list of data frames）
  path = tempfile(fileext = ".xlsx"),   # 輸出檔案路徑（預設為暫存檔）
  col_names = TRUE,            # 是否輸出欄位名稱
  format_headers = TRUE,       # 是否格式化欄位名稱（如粗體）
  use_zip64 = FALSE            # 是否使用 ZIP64（處理超大 Excel 檔案）
)

# 簡單匯出excel
write_xlsx(iris, "data/output/iris1.xlsx")

####################################################
#1. 假設有兩個 Data Frame: result_A 和 result_B
result_A <- data.frame(ID = 1:3, Value = c(10, 20, 30))
result_B <- data.frame(Group = c("X", "Y"), Mean = c(5.5, 8.2))

#2. 使用 list() 將多個 Data Frame 組合成一個列表，並指定每個工作表的名稱
data_list <- list(
  "Result_Set_A" = result_A, # 第一個工作表名稱為 Result_Set_A
  "Result_Set_B" = result_B  # 第二個工作表名稱為 Result_Set_B
)

#3. 使用 write_xlsx() 寫入 Excel 檔案
write_xlsx(
  x = data_list, 
  path = "data/output/analysis_summary.xlsx"
)

```

#### 方法 2：使用 openxlsx

openxlsx有豐富的函式，可以客製化輸出一些特殊的格式

```{r eval=FALSE , message=FALSE, warning=FALSE}
library(openxlsx)
# 方法1 :簡單匯出excel
data(iris)  # 載入 iris 資料集
write.xlsx(iris, file = "data/output/iris.xlsx")

# 方法2 : 另一種方式
# 建立新的Excel工作簿
wb = createWorkbook()

# 添加工作表並寫入資料
addWorksheet(wb, "mtcars數據")
writeData(wb, sheet="mtcars數據", mtcars)

# 儲存Excel檔案
saveWorkbook(wb, "data/output/mtcars.xlsx", overwrite=TRUE)

```

### 匯出為json檔

```{r eval=FALSE , message=FALSE, warning=FALSE}
library(jsonlite)

# 將資料框轉換為JSON格式並儲存
json_data = toJSON(mtcars, pretty=TRUE)
write(json_data, "data/output/mtcars.json")

# 直接將物件轉為JSON並寫入檔案
write_json(mtcars, "data/output/mtcars2.json", pretty=TRUE)

```

### 匯出為R資料格式

```{r eval=FALSE , message=FALSE, warning=FALSE}
# 儲存單一物件為RDS格式
saveRDS(mtcars, "data/output/mtcars.rds")

# 儲存多個物件為RData格式
save(iris, mtcars, file="data/output/my_data.RData")

```
